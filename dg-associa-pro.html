<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>DG ASSOCIA PRO – Conditions générales – O.S.D.9.T.D.J.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

  <meta name="description" content="Lecture intégrée des conditions générales Allianz Associa Pro (PDF) avec navigation et ambiance du site O.S.D.9.T.D.J.">
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1">
  <meta name="theme-color" content="#0b0b0b">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <link rel="canonical" href="https://osd9tdj.org/dg-associa-pro.html">

  <meta property="og:locale" content="fr_FR">
  <meta property="og:site_name" content="OSD9TDJ">
  <meta property="og:title" content="DG ASSOCIA PRO – Conditions générales – O.S.D.9.T.D.J.">
  <meta property="og:description" content="Lecteur PDF intégré (mobile/tablette) pour consulter les conditions générales Allianz.">
  <meta property="og:image" content="https://osd9tdj.org/assurance.jpg">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://osd9tdj.org/dg-associa-pro.html">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

  <!-- PDF.js LOCAL (même domaine = pas de blocage CSP/CDN) -->
  <link rel="stylesheet" href="/pdfjs/pdf_viewer.min.css">
  <script src="/pdfjs/pdf.min.js"></script>

  <style>
    :root{
      --or:#d6a728;
      --clair:#f5f0e6;
      --or-line:rgba(214,167,40,0.55);
    }
    html,body{
      height:100%;
      margin:0;
      padding:0;
      overflow:hidden;
      font-family:'Lato', Arial, sans-serif;
      color:var(--clair);
      background: radial-gradient(circle at top, #1b1b1b, #020202 70%);
      position:relative;
    }
    .frame-fixed{
      position: fixed;
      inset: 14px;
      border-radius: 22px;
      border: 2px solid var(--or-line);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.08) inset, 0 0 38px rgba(0,0,0,0.40);
      pointer-events: none;
      z-index: 40;
    }
    .menu-dot{
      position: fixed;
      right: 26px;
      top: calc(26px + env(safe-area-inset-top));
      z-index: 100;
      pointer-events: auto;
      width: 46px;
      height: 34px;
      display: grid;
      place-items: center;
      border-radius: 999px;
      border: 1px solid rgba(214,167,40,0.55);
      background: rgba(0,0,0,0.22);
      backdrop-filter: blur(6px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.35);
      font-family:'Cinzel',serif;
      color: #d6a728;
      font-size: 22px;
      line-height: 1;
      text-decoration: none;
      user-select: none;
    }
    .menu-dot:hover{ background: rgba(214,167,40,0.12); color:#fff; }

    .viewport-scroll{
      position: fixed;
      inset: 22px;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      z-index: 1;
      padding: 18px 14px 18px;
      box-sizing: border-box;
    }

    .header{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(214,167,40,0.35);
      background: rgba(0,0,0,0.45);
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 22px rgba(0,0,0,0.35);
      margin-bottom: 12px;
    }
    .title{
      font-family:'Cinzel',serif;
      font-weight:700;
      letter-spacing:0.04em;
      text-transform:uppercase;
      font-size: 0.95rem;
      color: rgba(245,240,230,0.92);
    }
    .subtitle{
      margin-top:6px;
      font-size:0.84rem;
      opacity:0.88;
      max-width: 90ch;
      line-height:1.35;
    }
    .status{
      margin: 10px 0 0;
      font-size:0.85rem;
      opacity:0.92;
      line-height:1.35;
    }
    .status strong{ color: var(--or); }

    .btns{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:flex-end;
      align-items:center;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(214,167,40,0.60);
      background: rgba(0,0,0,0.35);
      color: rgba(245,240,230,0.92);
      text-decoration:none;
      font-family:'Cinzel',serif;
      font-weight:700;
      font-size:0.82rem;
      user-select:none;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn:hover{ background: rgba(214,167,40,0.14); color:#fff; }

    .pdf-shell{
      border-radius: 18px;
      overflow:hidden;
      border: 2px solid rgba(214, 167, 40, 0.55);
      box-shadow: 0 0 35px rgba(0,0,0,0.65);
      background: rgba(0,0,0,0.35);
      padding: 14px 10px 16px;
    }

    #pdfPages{
      display:flex;
      flex-direction:column;
      gap: 14px;
      align-items:center;
      justify-content:flex-start;
      transform-origin: center top;
      touch-action: pan-y pinch-zoom;
    }
    .page{ width:100%; display:flex; justify-content:center; }
    canvas{
      border-radius: 10px;
      background:#111;
      box-shadow: 0 10px 26px rgba(0,0,0,0.55);
      max-width: 100%;
      height: auto;
      display:block;
    }

    .fallback{
      margin-top: 12px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(214,167,40,0.35);
      background: rgba(0,0,0,0.45);
      display:none;
    }

    .hint{
      margin-top: 10px;
      font-size:0.82rem;
      opacity:0.85;
      line-height:1.35;
    }

    @media (max-width:600px){
      .frame-fixed{ inset:12px; }
      .viewport-scroll{ inset:20px; padding: 14px 12px 14px; }
      .menu-dot{ right:22px; top: calc(22px + env(safe-area-inset-top)); }
      .title{ font-size:0.9rem; }
      .pdf-shell{ padding: 12px 8px 14px; }
    }
  </style>
</head>

<body>
  <div class="frame-fixed" aria-hidden="true"></div>
  <a class="menu-dot" href="menu.html" title="Menu" aria-label="Menu">⋯</a>

  <div class="viewport-scroll">
    <div class="header">
      <div>
        <div class="title">DG ASSOCIA PRO — Conditions générales</div>
        <div class="subtitle">
          Lecture intégrée au site (mobile/tablette). Faites défiler pour voir toutes les pages.
          Zoom possible (+/− ou pincement).
        </div>
        <div class="status" id="statusText">Chargement du document…</div>
      </div>

      <div class="btns">
        <button class="btn" type="button" id="btnBack">← Retour</button>
        <button class="btn" type="button" id="zoomOut">−</button>
        <button class="btn" type="button" id="zoomIn">+</button>
        <a class="btn" href="/DG%20ASSOCIA%20PRO.pdf" target="_blank" rel="noopener" id="btnOpenNative">↗ PDF normal</a>
      </div>
    </div>

    <div class="pdf-shell">
      <div id="pdfPages"></div>

      <div class="fallback" id="fallbackBox">
        <div class="title" style="font-size:0.9rem;">Affichage intégré indisponible</div>
        <div class="subtitle" style="margin-top:8px;">
          Si votre navigateur bloque l’affichage intégré, utilisez l’ouverture normale.
          <br><br>
          <span id="errDetail" style="opacity:.85;"></span>
        </div>
        <div class="btns" style="margin-top:10px; justify-content:flex-start;">
          <a class="btn" href="/DG%20ASSOCIA%20PRO.pdf" target="_blank" rel="noopener">↗ Ouvrir le PDF normal</a>
          <a class="btn" href="assurance.html">← Retour au site</a>
        </div>
      </div>

      <div class="hint">
        Astuce : sur mobile, le zoom “pincer” fonctionne. Sinon utilisez +/−.
      </div>
    </div>
  </div>

  <script>
  (function(){
    const PDF_URL = "/DG%20ASSOCIA%20PRO.pdf";
    const statusText = document.getElementById("statusText");
    const pagesEl = document.getElementById("pdfPages");
    const fallbackBox = document.getElementById("fallbackBox");
    const errDetail = document.getElementById("errDetail");

    // Retour = toujours assurance.html (comme tu veux)
    document.getElementById("btnBack").addEventListener("click", function(){
      location.href = "assurance.html";
    });

    // PDF.js worker en LOCAL
    if (!window.pdfjsLib) {
      showFallback("PDF.js non chargé (script local introuvable). Vérifie /pdfjs/pdf.min.js");
      return;
    }
    pdfjsLib.GlobalWorkerOptions.workerSrc = "/pdfjs/pdf.worker.min.js";

    let pdfDoc = null;
    let baseScale = 1;
    let userScale = 1;
    let rendering = false;

    function setStatus(html){ statusText.innerHTML = html; }

    function showFallback(msg){
      setStatus('Impossible d’afficher le document en mode intégré. <strong>Utilisez “PDF normal”.</strong>');
      if (errDetail) errDetail.textContent = "Détail : " + msg;
      fallbackBox.style.display = "block";
    }

    function clearPages(){
      while(pagesEl.firstChild) pagesEl.removeChild(pagesEl.firstChild);
    }

    function computeFitScale(pageWidth){
      const shell = document.querySelector(".pdf-shell");
      const st = getComputedStyle(shell);
      const available = Math.max(280, shell.clientWidth - parseFloat(st.paddingLeft||0) - parseFloat(st.paddingRight||0));
      return available / pageWidth;
    }

    async function renderAll(){
      if(!pdfDoc || rendering) return;
      rendering = true;
      try{
        clearPages();
        fallbackBox.style.display = "none";

        const first = await pdfDoc.getPage(1);
        const vp1 = first.getViewport({ scale: 1 });
        baseScale = computeFitScale(vp1.width);

        const finalScale = baseScale * userScale;
        const total = pdfDoc.numPages;

        setStatus('Document chargé : <strong>' + total + '</strong> page(s). Défilez pour tout lire.');

        for(let i=1; i<=total; i++){
          const page = await pdfDoc.getPage(i);
          const viewport = page.getViewport({ scale: finalScale });

          const wrap = document.createElement("div");
          wrap.className = "page";

          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d", { alpha:false });

          const dpr = Math.min(2, window.devicePixelRatio || 1);
          canvas.width = Math.floor(viewport.width * dpr);
          canvas.height = Math.floor(viewport.height * dpr);
          canvas.style.width = Math.floor(viewport.width) + "px";
          canvas.style.height = Math.floor(viewport.height) + "px";
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

          wrap.appendChild(canvas);
          pagesEl.appendChild(wrap);

          await page.render({ canvasContext: ctx, viewport }).promise;
        }
      }catch(e){
        showFallback(e && e.message ? e.message : String(e));
      }finally{
        rendering = false;
      }
    }

    async function load(){
      try{
        setStatus("Chargement du document…");
        pdfDoc = await pdfjsLib.getDocument({ url: PDF_URL }).promise;
        await renderAll();
      }catch(e){
        showFallback(e && e.message ? e.message : String(e));
      }
    }

    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

    document.getElementById("zoomIn").addEventListener("click", async function(){
      userScale = clamp(userScale * 1.15, 0.6, 3.0);
      await renderAll();
    });
    document.getElementById("zoomOut").addEventListener("click", async function(){
      userScale = clamp(userScale / 1.15, 0.6, 3.0);
      await renderAll();
    });

    // pinch zoom : preview + rerender à la fin
    let pinch = false, startDist = 0, startScale = 1;
    function dist(t1,t2){
      const dx=t1.clientX-t2.clientX, dy=t1.clientY-t2.clientY;
      return Math.sqrt(dx*dx+dy*dy);
    }

    pagesEl.addEventListener("touchstart", function(e){
      if(e.touches && e.touches.length===2){
        pinch = true;
        startDist = dist(e.touches[0], e.touches[1]);
        startScale = userScale;
      }
    }, { passive:true });

    pagesEl.addEventListener("touchmove", function(e){
      if(!pinch || !e.touches || e.touches.length!==2) return;
      const ratio = dist(e.touches[0], e.touches[1]) / startDist;
      const preview = clamp(startScale * ratio, 0.6, 3.0);
      pagesEl.style.transform = "scale(" + preview.toFixed(3) + ")";
      pagesEl.style.transition = "none";
    }, { passive:true });

    async function endPinch(){
      if(!pinch) return;
      pinch = false;
      const m = pagesEl.style.transform.match(/scale\(([^)]+)\)/);
      const final = m ? parseFloat(m[1]) : userScale;
      pagesEl.style.transform = "";
      userScale = clamp(final, 0.6, 3.0);
      await renderAll();
    }

    pagesEl.addEventListener("touchend", function(e){
      if(!e.touches || e.touches.length<2) endPinch();
    }, { passive:true });
    pagesEl.addEventListener("touchcancel", endPinch, { passive:true });

    // Re-render orientation/tablette
    let t=null;
    window.addEventListener("resize", function(){
      if(!pdfDoc) return;
      clearTimeout(t);
      t=setTimeout(renderAll, 180);
    });

    load();
  })();
  </script>

  <script defer src="/osd.js"></script>
</body>
</html>
