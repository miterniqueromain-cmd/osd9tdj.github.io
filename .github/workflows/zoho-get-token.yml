name: Zoho - Get Token (one shot)

on:
  workflow_dispatch:
    inputs:
      code:
        description: "Zoho authorization code (the 1000.... from https://localhost/?code=...)"
        required: true

jobs:
  token:
    runs-on: ubuntu-latest
    steps:
      - name: Exchange code for token
        env:
          CLIENT_ID: ${{ 1000.QAU0PI6LILOFZ5S1VUW26YXO40NEAU }}
          CLIENT_SECRET: ${{  e6361b0f585260f902ee6d9caf4667eb1389f92cc5 }}
          CODE: ${{ github.event.inputs.code }}
        run: |
          echo "::add-mask::$CLIENT_ID"
          echo "::add-mask::$CLIENT_SECRET"
          echo "::add-mask::$CODE"

          curl -sS -X POST "https://accounts.zoho.eu/oauth/v2/token" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            --data-urlencode "grant_type=authorization_code" \
            --data-urlencode "client_id=$CLIENT_ID" \
            --data-urlencode "client_secret=$CLIENT_SECRET" \
            --data-urlencode "redirect_uri=https://localhost/" \
            --data-urlencode "code=$CODE" | tee response.json
