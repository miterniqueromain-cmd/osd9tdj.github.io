<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Administration ‚Äì Acc√®s r√©serv√© (Bureau) | OSD9TDJ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="color-scheme" content="dark">

  <!-- Interne : anti-indexation / anti-cache -->
  <meta name="robots" content="noindex,nofollow,noarchive,nosnippet,max-snippet:-1,max-image-preview:none,max-video-preview:-1">
  <meta name="googlebot" content="noindex,nofollow,noarchive,nosnippet,max-snippet:-1,max-image-preview:none,max-video-preview:-1">
  <meta name="bingbot" content="noindex,nofollow,noarchive,nosnippet,max-snippet:-1,max-image-preview:none,max-video-preview:-1">

  <!-- S√©curit√© -->
  <meta name="referrer" content="no-referrer">

  <!-- CSP : autorise Zoho en iframe + JS inline -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    base-uri 'self';
    form-action 'self';
    frame-ancestors 'none';
    object-src 'none';
    connect-src 'none';
    img-src 'self' https: data:;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src https://fonts.gstatic.com;
    script-src 'self' 'unsafe-inline';
    frame-src https://workdrive.zohopublic.eu https://*.zohopublic.eu https://*.zoho.com https://*.zoho.eu;
    upgrade-insecure-requests;
  ">

  <!-- Watermarks internes -->
  <meta name="osd9tdj-signature" content="WTRMK-ADMIN-OMEGA-2026-OSD9TDJ-BUREAU-ACCESS-RESERVE" />
  <meta name="osd9tdj-origin" content="osd9tdj.org / administration.html" />

  <!-- Polices -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root{
      --or:#ffd700;
      --clair:#fdf7e5;
      --orSoft: rgba(255,215,0,0.45);
      --orLine: rgba(255,215,0,0.28);
      --darkA: rgba(0,0,0,0.62);
      --darkB: rgba(0,0,0,0.92);
    }
    *{ box-sizing:border-box; }

    html, body{
      height:100%;
      margin:0;
      padding:0;
      overflow:hidden;
      font-family:'Lato', Arial, sans-serif;
      color:#fff;
      text-align:center;
      min-height:100vh;
    }

    /* Fond admin */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background-image:url("fond-adm.JPG");
      background-repeat:no-repeat;
      background-position:center center;
      background-size:cover;
      background-attachment:fixed;
      z-index:-2;
    }
    @media (max-width: 900px){
      body::before{ background-attachment:scroll; }
    }

    /* Cadre fixe */
    .frame-fixed{
      position:fixed;
      inset:14px;
      border-radius:22px;
      border:2px solid rgba(255,215,0,0.55);
      box-shadow:
        0 0 0 1px rgba(253,247,229,0.16) inset,
        0 0 38px rgba(0,0,0,0.35);
      pointer-events:none;
      z-index:40;
    }

    /* Scroll interne */
    .viewport-scroll{
      position:fixed;
      inset:22px;
      overflow-y:auto;
      overflow-x:hidden;
      -webkit-overflow-scrolling:touch;
      z-index:1;
    }

    /* Menu 3 points */
    .top-menu{
      position:fixed;
      top:26px;
      right:26px;
      z-index:60;
      pointer-events:auto;
    }
    .top-menu details{ position:relative; }
    .top-menu summary{
      list-style:none;
      cursor:pointer;
      user-select:none;
      width:46px;
      height:34px;
      display:grid;
      place-items:center;
      border-radius:999px;
      border:1px solid rgba(255,215,0,0.55);
      background:rgba(0,0,0,0.22);
      backdrop-filter: blur(6px);
      box-shadow:0 6px 16px rgba(0,0,0,0.35);
      font-family:'Cinzel',serif;
      color:var(--or);
      font-size:22px;
      line-height:1;
      outline:none;
    }
    .top-menu summary::-webkit-details-marker{ display:none; }
    .top-menu summary:focus-visible{
      box-shadow:0 0 0 3px rgba(255,215,0,0.25), 0 6px 16px rgba(0,0,0,0.35);
    }

    .menu-panel{
      position:absolute;
      right:0;
      margin-top:10px;
      width:290px;
      max-width:calc(100vw - 60px);
      border-radius:14px;
      border:1px solid rgba(255,215,0,0.45);
      background:rgba(0,0,0,0.80);
      box-shadow:0 18px 40px rgba(0,0,0,0.55);
      overflow:hidden;
    }
    .menu-panel a{
      display:block;
      padding:11px 12px;
      text-decoration:none;
      color:rgba(253,247,229,0.92);
      font-family:'Cinzel',serif;
      font-weight:700;
      font-size:0.92rem;
      border-bottom:1px solid rgba(255,215,0,0.18);
    }
    .menu-panel a:hover{
      background:rgba(255,215,0,0.10);
      color:#fff;
    }
    .menu-panel a:last-child{ border-bottom:none; }

    /* Voile */
    .overlay{
      min-height:100vh;
      padding:30px 15px 28px;
      box-sizing:border-box;
      background: radial-gradient(circle at top, rgba(0,0,0,0.38), rgba(0,0,0,0.48));
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    /* Badge */
    .lock-badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 18px;
      border-radius:999px;
      border:1px solid var(--orSoft);
      background:rgba(0,0,0,0.55);
      font-family:'Cinzel',serif;
      font-weight:700;
      color:var(--or);
      margin:8px auto 10px;
      box-shadow:0 0 18px rgba(0,0,0,0.65);
    }

    h1{
      font-family:'Cinzel',serif;
      font-size:1.9rem;
      margin:6px 0 6px;
      text-shadow:0 0 8px rgba(0,0,0,0.7);
    }
    .subtitle{
      font-size:0.95rem;
      opacity:0.95;
      margin:0 0 12px;
      max-width:980px;
    }

    /* Avertissement */
    .warning{
      width:100%;
      max-width:980px;
      margin:10px auto 14px;
      padding:14px 14px;
      border-radius:16px;
      border:1px solid rgba(255,215,0,0.28);
      background:rgba(0,0,0,0.62);
      text-align:left;
      box-shadow:0 0 22px rgba(0,0,0,0.65);
    }
    .warning strong{
      font-family:'Cinzel',serif;
      color:var(--or);
      letter-spacing:0.03em;
    }
    .warning p{
      margin:8px 0 0;
      font-size:0.92rem;
      line-height:1.45;
      opacity:0.92;
    }

    /* Bouton or (centr√©) */
    .btn-or{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:8px;
      padding:9px 14px;
      border-radius:999px;
      background: linear-gradient(135deg, #ffd700, #e6c200);
      color:#111;
      text-decoration:none;
      font-family:'Cinzel',serif;
      font-weight:700;
      font-size:0.86rem;
      box-shadow:
        0 0 0 1px rgba(255,215,0,0.75) inset,
        0 6px 14px rgba(0,0,0,0.45);
      margin:10px auto;
      border:0;
      cursor:pointer;
      width:100%;
      max-width:340px;
      text-align:center;
    }
    .btn-or:focus-visible{ outline:3px solid rgba(255,215,0,0.35); outline-offset:2px; }

    /* Accord√©ons */
    .accordion{
      width:100%;
      max-width:980px;
      margin:12px auto 0;
      background:rgba(0,0,0,0.60);
      border:1px solid rgba(255,215,0,0.28);
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 0 22px rgba(0,0,0,0.65);
      text-align:left;
    }
    .accordion summary{
      cursor:pointer;
      list-style:none;
      user-select:none;
      padding:14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      font-family:'Cinzel',serif;
      color:var(--or);
      font-weight:700;
      letter-spacing:0.04em;
      background:rgba(0,0,0,0.45);
      border-bottom:1px solid rgba(255,215,0,0.14);
      outline:none;
    }
    .accordion summary::-webkit-details-marker{ display:none; }
    .accordion summary:focus-visible{ outline:3px solid rgba(255,215,0,0.28); outline-offset:-3px; }
    .acc-right{ color:rgba(255,215,0,0.85); font-size:1.1rem; }
    .acc-body{ padding:14px; }

    /* Sous-accord√©ons */
    .subacc{
      margin:10px 0 0;
      border:1px solid rgba(255,215,0,0.18);
      border-radius:16px;
      overflow:hidden;
      background:rgba(0,0,0,0.35);
    }
    .subacc summary{
      padding:12px 12px;
      font-size:0.95rem;
      border-bottom:1px solid rgba(255,215,0,0.12);
    }

    /* Cartes */
    .cards{
      display:grid;
      grid-template-columns:repeat(1, minmax(0, 1fr));
      gap:16px;
      width:100%;
      margin:0;
    }
    @media (min-width: 700px){
      .cards{ grid-template-columns:repeat(2, minmax(0, 1fr)); }
    }
    @media (min-width: 1000px){
      .cards{ grid-template-columns:repeat(3, minmax(0, 1fr)); }
    }
    .card{
      background:rgba(0,0,0,0.62);
      border:1px solid rgba(255,215,0,0.35);
      border-radius:18px;
      padding:16px 14px;
      box-shadow:0 0 18px rgba(0,0,0,0.55);
    }
    .card h3{
      font-family:'Cinzel',serif;
      font-size:1.0rem;
      color:var(--or);
      margin:0 0 8px;
    }
    .card p{
      font-size:0.9rem;
      opacity:0.92;
      margin:0 0 12px;
      line-height:1.45;
    }
    .card a{
      display:flex;
      justify-content:center;
      align-items:center;
      margin-left:auto;
      margin-right:auto;
      text-align:center;
      padding:9px 14px;
      border-radius:999px;
      background:rgba(255,215,0,0.16);
      color:#fff;
      text-decoration:none;
      font-weight:700;
      border:1px solid rgba(255,215,0,0.45);
      font-family:'Cinzel',serif;
      font-size:0.82rem;
      max-width:240px;
      width:100%;
    }
    .card a:hover{ background:rgba(255,215,0,0.28); }
    .card a:focus-visible{ outline:3px solid rgba(255,215,0,0.28); outline-offset:2px; }

    /* Footer */
    .footer{
      margin-top: 18px;
      padding-top: 15px;
      font-size: 0.8rem;
      opacity: 0.92;
      line-height: 1.35rem;
      width:100%;
      max-width: 980px;
      border-top: 1px solid rgba(255,215,0,0.20);
    }
    .footer .line{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:center;
      font-size:0.78rem;
      color: rgba(253,247,229,0.88);
    }
    .footer a{
      color: rgba(253,247,229,0.85) !important;
      text-decoration:none !important;
      border-bottom: 1px dotted rgba(255,215,0,0.55);
      padding-bottom: 1px;
      font-size:0.72rem;
      text-transform: lowercase;
    }

    @media (max-width: 480px){
      .top-menu{ top:22px; right:22px; }
      .menu-panel{ width:240px; }
      .frame-fixed{ inset:12px; }
      .viewport-scroll{ inset:20px; }
      h1{ font-size:1.6rem; }
    }
    @media (max-width: 600px){
      .btn-or{ max-width:320px; }
      .card a{ max-width:220px; }
    }
    @media (min-width: 601px) and (max-width: 1024px){
      .btn-or{ max-width:340px; }
      .card a{ max-width:240px; }
    }

    /* =====================================================
       MODALE ZOHO "ULTRA COCKPIT" (menu+recherche+favoris+recents+tabs+split view)
       ===================================================== */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.80);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:18px;
    }
    .modal.open{ display:flex; }

    .modal-card{
      width:min(1350px, 96vw);
      height:min(860px, 90vh);
      background:rgba(0,0,0,0.92);
      border:1px solid rgba(255,215,0,0.55);
      border-radius:18px;
      box-shadow:0 20px 60px rgba(0,0,0,0.75);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .modal-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,215,0,0.18);
      background:rgba(0,0,0,0.65);
    }
    .modal-title{
      font-family:'Cinzel',serif;
      color:var(--or);
      font-weight:700;
      font-size:0.95rem;
      letter-spacing:0.04em;
      text-align:left;
    }
    .modal-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .btn-mini{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(255,215,0,0.14);
      color:#fff;
      text-decoration:none;
      font-weight:700;
      border:1px solid rgba(255,215,0,0.40);
      font-family:'Cinzel',serif;
      font-size:0.78rem;
      cursor:pointer;
      white-space:nowrap;
      user-select:none;
    }
    .btn-mini:hover{ background:rgba(255,215,0,0.24); }
    .btn-mini[aria-pressed="true"]{
      background:rgba(255,215,0,0.22);
      border-color:rgba(255,215,0,0.55);
    }

    .modal-content{
      flex:1 1 auto;
      display:flex;
      min-height:0;
      position:relative;
    }

    /* Sidebar */
    .modal-sidebar{
      width:360px;
      min-width:260px;
      max-width:48vw;
      border-right:1px solid rgba(255,215,0,0.18);
      background:rgba(0,0,0,0.76);
      display:flex;
      flex-direction:column;
      min-height:0;
      z-index:2;
    }

    .sidebar-top{
      padding:10px 10px 8px;
      border-bottom:1px solid rgba(255,215,0,0.16);
      background:rgba(0,0,0,0.55);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .sidebar-title{
      font-family:'Cinzel',serif;
      color:rgba(255,215,0,0.92);
      font-weight:700;
      letter-spacing:0.03em;
      font-size:0.92rem;
      text-align:left;
    }
    .sidebar-sub{
      font-size:0.78rem;
      opacity:0.88;
      text-align:left;
      line-height:1.25;
    }

    .sidebar-tools{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-start;
    }

    .sidebar-search{
      width:100%;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,215,0,0.25);
      background:rgba(0,0,0,0.55);
      color:rgba(253,247,229,0.92);
      outline:none;
    }
    .sidebar-search::placeholder{ color:rgba(253,247,229,0.55); }

    .sidebar-list{
      padding:10px;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      min-height:0;
    }
    .sidebar-group{
      margin:12px 0 6px;
      font-family:'Cinzel',serif;
      color:rgba(255,215,0,0.88);
      font-weight:700;
      font-size:0.80rem;
      letter-spacing:0.03em;
      opacity:0.95;
      text-align:left;
    }

    .sidebar-item{
      display:flex;
      gap:8px;
      align-items:stretch;
      margin:6px 0;
    }
    .sidebar-link{
      flex:1 1 auto;
      text-align:left;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,215,0,0.18);
      background:rgba(0,0,0,0.35);
      color:rgba(253,247,229,0.92);
      cursor:pointer;
      font-weight:700;
      font-family:'Lato', Arial, sans-serif;
      line-height:1.15;
    }
    .sidebar-link:hover{ background:rgba(255,215,0,0.10); }
    .sidebar-link.active{
      border-color:rgba(255,215,0,0.45);
      background:rgba(255,215,0,0.10);
    }

    .sidebar-mini{
      width:44px;
      min-width:44px;
      border-radius:12px;
      border:1px solid rgba(255,215,0,0.18);
      background:rgba(0,0,0,0.35);
      color:rgba(253,247,229,0.92);
      cursor:pointer;
      font-weight:900;
      display:grid;
      place-items:center;
      font-family:'Cinzel',serif;
      user-select:none;
    }
    .sidebar-mini:hover{ background:rgba(255,215,0,0.10); }

    .sidebar-footer{
      padding:10px;
      border-top:1px solid rgba(255,215,0,0.18);
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:center;
      background:rgba(0,0,0,0.55);
    }

    /* Main */
    .modal-main{
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      min-width:0;
      min-height:0;
    }

    /* Tabs */
    .modal-tabs{
      display:flex;
      gap:8px;
      padding:10px;
      border-bottom:1px solid rgba(255,215,0,0.14);
      background:rgba(0,0,0,0.55);
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }
    .tab{
      display:flex;
      align-items:center;
      gap:10px;
      border:1px solid rgba(255,215,0,0.18);
      background:rgba(0,0,0,0.35);
      color:rgba(253,247,229,0.92);
      border-radius:999px;
      padding:8px 12px;
      cursor:pointer;
      white-space:nowrap;
      font-weight:700;
      user-select:none;
    }
    .tab.active{
      border-color:rgba(255,215,0,0.45);
      background:rgba(255,215,0,0.10);
    }
    .tab .x{
      font-weight:900;
      opacity:0.85;
      border:1px solid rgba(255,215,0,0.18);
      width:18px; height:18px;
      display:grid; place-items:center;
      border-radius:999px;
    }
    .tab .x:hover{ background:rgba(255,215,0,0.10); }

    /* Split area */
    .modal-body{
      flex:1 1 auto;
      min-height:0;
      position:relative;
      background:#000;
    }

    .split-wrap{
      position:absolute;
      inset:0;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      padding:10px;
    }
    .split-wrap.split{
      grid-template-columns: 1fr 1fr;
    }

    .pane{
      position:relative;
      border:1px solid rgba(255,215,0,0.18);
      border-radius:14px;
      overflow:hidden;
      background:#000;
      min-height:0;
    }
    .pane-head{
      position:absolute;
      top:0; left:0; right:0;
      z-index:2;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:8px 10px;
      background:rgba(0,0,0,0.55);
      border-bottom:1px solid rgba(255,215,0,0.14);
    }
    .pane-title{
      font-family:'Cinzel',serif;
      color:rgba(255,215,0,0.92);
      font-weight:700;
      font-size:0.82rem;
      text-align:left;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .pane-actions{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    .zoho-frame{
      position:absolute;
      inset:36px 0 0 0;
      width:100%;
      height:calc(100% - 36px);
      border:0;
      display:block;
      background:#000;
    }

    .modal-hint{
      padding:10px 12px;
      border-top:1px solid rgba(255,215,0,0.18);
      font-size:0.82rem;
      opacity:0.90;
      line-height:1.35;
      text-align:left;
      background:rgba(0,0,0,0.55);
    }

    /* Fallback overlay */
    .zoho-fallback{
      position:absolute;
      inset:36px 0 0 0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      background:rgba(0,0,0,0.82);
      z-index:3;
    }
    .fallback-card{
      width:min(600px, 100%);
      border-radius:16px;
      border:1px solid rgba(255,215,0,0.35);
      background:rgba(0,0,0,0.92);
      box-shadow:0 20px 60px rgba(0,0,0,0.75);
      padding:14px;
      text-align:left;
    }
    .fallback-title{
      font-family:'Cinzel',serif;
      color:var(--or);
      font-weight:700;
      margin-bottom:8px;
    }
    .fallback-text{
      font-size:0.9rem;
      opacity:0.92;
      line-height:1.45;
    }
    .fallback-actions{
      margin-top:12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* Sidebar mobile */
    .modal-sidebar-backdrop{
      display:none;
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.35);
      z-index:1;
    }

    @media (max-width: 820px){
      .modal-card{ width:min(1100px, 96vw); }
      .modal-sidebar{ width:330px; }
    }

    @media (max-width: 760px){
      .modal-sidebar{
        position:absolute;
        left:0; top:0; bottom:0;
        transform:translateX(-102%);
        transition:transform 180ms ease;
        width:min(88vw, 360px);
      }
      .modal-sidebar.open{ transform:translateX(0); }
      .modal-sidebar-backdrop.open{ display:block; }
      .split-wrap.split{ grid-template-columns: 1fr; } /* en mobile, split => empile */
    }

    @media (prefers-reduced-motion: reduce){
      .modal-sidebar{ transition:none !important; }
    }
  </style>
</head>

<body>
  <script>window.ACCESS_GROUP="BUREAU_ADMIN"</script>
  <script src="js/membres-lock.js" defer></script>

  <div class="frame-fixed" aria-hidden="true"></div>

  <div class="top-menu" aria-label="Menu administration">
    <details>
      <summary title="Menu" aria-label="Ouvrir le menu">‚ãØ</summary>
      <div class="menu-panel" role="menu" aria-label="Navigation admin">
        <a href="#bureau" role="menuitem"> Bureau (priv√©)</a>
        <a href="#membres" role="menuitem"> Membres (gestion)</a>
        <a href="documents-internes.html" role="menuitem">‚Üê Page membres</a>
        <a href="index.html" role="menuitem">‚Üê Retour site public</a>
      </div>
    </details>
  </div>

  <div class="viewport-scroll">
    <div class="overlay">

      <div class="lock-badge">üîí Administration ‚Äì Acc√®s strictement r√©serv√©</div>
      <h1>Administration</h1>
      <p class="subtitle">Page r√©serv√©e au Bureau. Ne pas modifier sans autorisation.</p>

      <div class="warning">
        <strong>AVERTISSEMENT ‚Äì ACC√àS R√âSERV√â</strong>
        <p>
          Page destin√©e exclusivement aux membres autoris√©s du Bureau de l‚Äôassociation.
          Toute tentative d‚Äôacc√®s non autoris√©, alt√©ration, extraction ou usage frauduleux est interdite.
          Des mesures pourront √™tre engag√©es en cas d‚Äôabus.
        </p>
      </div>

      <a class="btn-or" href="index.html">‚Üê Retour au site public</a>

      <!-- 1) BUREAU (PRIV√â) -->
      <details class="accordion" id="bureau" open>
        <summary><span>Documents Bureau (priv√©)</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
        <div class="acc-body">

          <details class="subacc">
            <summary><span>Grand Ma√Ætre</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
            <div class="acc-body">
              <div class="cards">
                <div class="card">
                  <h3>Dossier Grand Ma√Ætre</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/51a1d98123ea4b58e1fdebf5a8cbeb28d927b6b9ed2d0694bd35df882d51d680">Acc√©der</a>
                </div>
              </div>
            </div>
          </details>

          <details class="subacc">
            <summary><span>Secr√©tariat</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
            <div class="acc-body">
              <div class="cards">
                <div class="card">
                  <h3>Dossier Secr√©tariat</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/b0ed872395e698603ed3217aa8244717fe756cd7a9b9635c1412a7cdfe5aaf79">Acc√©der</a>
                </div>
              </div>
            </div>
          </details>

          <details class="subacc">
            <summary><span>Tr√©sorerie</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
            <div class="acc-body">
              <div class="cards">
                <div class="card">
                  <h3>Dossier Tr√©sorerie</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/64aade6f8518560e79dc7f32ee0e74fc63d9fb98c4bdafab34cfb5cb05943447">Acc√©der</a>
                </div>
              </div>
            </div>
          </details>

          <details class="subacc">
            <summary><span>Archives (Bureau)</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
            <div class="acc-body">
              <div class="cards">
                <div class="card">
                  <h3>Dossier Archives (Bureau)</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/ac5bcfc0c99200759e63f52a0645b7669df2a0c679dd0428c84d708ce0412da9">Acc√©der</a>
                </div>
              </div>
            </div>
          </details>

        </div>
      </details>

      <!-- 2) MEMBRES (GESTION) -->
      <details class="accordion" id="membres">
        <summary><span>Membres (gestion ‚Äì liens avec droits d√©p√¥t/√©dition)</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
        <div class="acc-body">

          <details class="subacc" open>
            <summary><span>Nouveaux adh√©rents (d√©p√¥t)</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
            <div class="acc-body">
              <div class="cards">
                <div class="card">
                  <h3>Dossier ‚ÄúNouveaux adh√©rents‚Äù</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/c908e2e93ed4c53b28193edf2ccd0e5f8ae9e6ad6da69b1103cdfead38110232">Acc√©der</a>
                </div>
              </div>
            </div>
          </details>

          <details class="subacc" open>
            <summary><span>Organisation & administratif (gestion)</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
            <div class="acc-body">
              <div class="cards">
                <div class="card">
                  <h3>Statuts & r√®glements</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/bbef14e164079f93e6d88eb08493afc8b65962984d1c4e95d3d157e6e6aacb54">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Proc√®s-verbaux & comptes annuels</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/c89bc0b3c3c962a816fda411040256fdfbfefbb0d28f5252cbbdc0b9bfd4af9b">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Documents Pr√©fecture</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/6e035cbdb2d328f5ba7e109cfddec59fab7660d3b86d8d553e15c3f972fb261f">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Convocations</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/0e178282709b8d3facd6c91d6031c6edd3fb535335cdb5d4e0a538cfa28a6293">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Organisation des √©v√©nements</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/87b22a0ae0f1f4a527536ae6fbb85b50ba8fe9aa4c02d6fc246150ac26320a75">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Planning annuel</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/9d5321250fedd941495981ea972a17d4dc5481e91867796086c832a319118aab">Acc√©der</a>
                </div>
              </div>
            </div>
          </details>

          <details class="subacc">
            <summary><span>√âtudes (gestion)</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
            <div class="acc-body">
              <div class="cards">
                <div class="card">
                  <h3>Documents d‚Äô√©tude</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/9b7e1c9f22f75fa5052043249d083584b7a71ed1eb614e50baf4e08a0108c277">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Planches d‚Äô√©tude</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/4242791467f71f9782fd92e6a59b35d7d6b52272be0a5eb4811bfe0fbb7220ca">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Proc√®s-verbaux (√âtudes)</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/c91963d5a302cd8f69bb52ac308f1d5b82535f8006034238966e5f0f57ea785f">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Travaux & documents</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/49fbeba7065a33191da058278d3abfbc27a4a64905c497df7c9da1837aad78f2">Acc√©der</a>
                </div>
                <div class="card">
                  <h3>Biblioth√®que d‚Äô√©tude</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/b671cad53f794c23d87ab80e01f71bfd993d40fb60c36b2d512efb13d72c4ad5">Acc√©der</a>
                </div>
              </div>
            </div>
          </details>

          <details class="subacc">
            <summary><span>Archives (gestion)</span><span class="acc-right" aria-hidden="true">‚ñæ</span></summary>
            <div class="acc-body">
              <div class="cards">
                <div class="card">
                  <h3>Archives ‚Äì Doctrine interne</h3>
                  <p>&nbsp;</p>
                  <a href="https://workdrive.zohopublic.eu/external/fdd8772d8fa8be5bb31e7a86e79e8f5448ee6259863b9644e60510e66c263ea3">Acc√©der</a>
                </div>
              </div>
            </div>
          </details>

        </div>
      </details>

      <a class="btn-or" href="documents-internes.html">‚Üê Retour √† la page membres</a>

      <div class="footer">
        <div class="line">
          <span>¬© OSD9TDJ Association Loi 1901, Tous droits r√©serv√©s</span>
          <span>¬∑</span>
          <a href="mentions.html">mentions l√©gales</a>
          <span>¬∑</span>
          <a href="cookies.html">cookies</a>
        </div>
      </div>

    </div>
  </div>

  <!-- MODALE ZOHO ‚Äì ULTRA COCKPIT -->
  <div class="modal" id="zohoModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Documents Zoho">

      <div class="modal-head">
        <div class="modal-title" id="zohoModalTitle">Documents</div>
        <div class="modal-actions">
          <button class="btn-mini" type="button" id="zohoToggleMenu">Menu</button>
          <button class="btn-mini" type="button" id="zohoSplit" aria-pressed="false" title="Activer/d√©sactiver la vue double">Split</button>
          <button class="btn-mini" type="button" id="zohoCopyLink">Copier</button>
          <button class="btn-mini" type="button" id="zohoClearTabs" title="Fermer tous les onglets">Tout fermer</button>
          <a class="btn-mini" id="zohoOpenExternal" href="#" target="_blank" rel="noopener noreferrer">Ouvrir Zoho</a>
          <button class="btn-mini" type="button" id="zohoReload">Recharger</button>
          <button class="btn-mini" type="button" id="zohoClose">Fermer</button>
        </div>
      </div>

      <div class="modal-content">
        <div class="modal-sidebar-backdrop" id="zohoSidebarBackdrop" aria-hidden="true"></div>

        <aside class="modal-sidebar" id="zohoSidebar" aria-label="Menu documents">
          <div class="sidebar-top">
            <div class="sidebar-title">üìÅ Dossiers</div>
            <div class="sidebar-sub" id="zohoSideStatus">
              Cliquer = ouvre/active. <strong>A</strong>=Pane A ¬∑ <strong>B</strong>=Pane B ¬∑ <strong>+</strong>=nouveau tab ¬∑ <strong>‚≠ê</strong>=favori
            </div>

            <div class="sidebar-tools">
              <button class="btn-mini" type="button" id="viewAll" aria-pressed="true">Tous</button>
              <button class="btn-mini" type="button" id="viewFav" aria-pressed="false">‚≠ê Favoris</button>
              <button class="btn-mini" type="button" id="viewRecent" aria-pressed="false">üïò R√©cents</button>
              <button class="btn-mini" type="button" id="clearRecent" title="Vider les r√©cents">Vider üïò</button>
            </div>

            <input class="sidebar-search" id="zohoSearch" type="search" placeholder="Rechercher un document‚Ä¶" />
          </div>

          <div class="sidebar-list" id="zohoSidebarList"></div>

          <div class="sidebar-footer">
            <a class="btn-mini" href="documents-internes.html">‚Üê Page membres</a>
            <a class="btn-mini" href="index.html">‚Üê Site public</a>
          </div>
        </aside>

        <main class="modal-main">
          <div class="modal-tabs" id="zohoTabs" aria-label="Onglets"></div>

          <div class="modal-body">
            <div class="split-wrap" id="splitWrap">
              <!-- Pane A -->
              <div class="pane" id="paneA">
                <div class="pane-head">
                  <div class="pane-title" id="paneATitle">Pane A</div>
                  <div class="pane-actions">
                    <a class="btn-mini" id="paneAOpen" href="#" target="_blank" rel="noopener noreferrer">‚Üó</a>
                    <button class="btn-mini" type="button" id="paneAReload">‚ü≥</button>
                  </div>
                </div>
                <iframe class="zoho-frame" id="zohoFrameA" title="Zoho A" src="about:blank"></iframe>

                <div class="zoho-fallback" id="fallbackA" hidden>
                  <div class="fallback-card">
                    <div class="fallback-title">‚ö†Ô∏è Pane A : iframe bloqu√©e</div>
                    <div class="fallback-text">Zoho peut refuser l‚Äôint√©gration. Utilise ‚Üó ou change de doc.</div>
                    <div class="fallback-actions">
                      <a class="btn-mini" id="fallbackAOpen" href="#" target="_blank" rel="noopener noreferrer">Ouvrir Zoho</a>
                      <button class="btn-mini" type="button" data-hide="fallbackA">Rester</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Pane B -->
              <div class="pane" id="paneB" style="display:none;">
                <div class="pane-head">
                  <div class="pane-title" id="paneBTitle">Pane B</div>
                  <div class="pane-actions">
                    <a class="btn-mini" id="paneBOpen" href="#" target="_blank" rel="noopener noreferrer">‚Üó</a>
                    <button class="btn-mini" type="button" id="paneBReload">‚ü≥</button>
                  </div>
                </div>
                <iframe class="zoho-frame" id="zohoFrameB" title="Zoho B" src="about:blank"></iframe>

                <div class="zoho-fallback" id="fallbackB" hidden>
                  <div class="fallback-card">
                    <div class="fallback-title">‚ö†Ô∏è Pane B : iframe bloqu√©e</div>
                    <div class="fallback-text">Zoho peut refuser l‚Äôint√©gration. Utilise ‚Üó ou change de doc.</div>
                    <div class="fallback-actions">
                      <a class="btn-mini" id="fallbackBOpen" href="#" target="_blank" rel="noopener noreferrer">Ouvrir Zoho</a>
                      <button class="btn-mini" type="button" data-hide="fallbackB">Rester</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-hint">
            Astuces :
            <strong>Split</strong> = 2 docs c√¥te √† c√¥te ¬∑ Dans le menu gauche :
            <strong>A</strong> ouvre dans Pane A, <strong>B</strong> dans Pane B,
            <strong>+</strong> force un nouvel onglet interne,
            <strong>‚Üó</strong> ouvre Zoho direct, <strong>‚≠ê</strong> ajoute aux favoris.
            Tout est m√©moris√© (tabs/favoris/r√©cents) sur l‚Äôappareil.
          </div>
        </main>
      </div>
    </div>
  </div>

  <script>
  // =========================
  // ZOHO ULTRA COCKPIT ENGINE
  // =========================

  // Elements
  const modal = document.getElementById("zohoModal");

  const closeBtn = document.getElementById("zohoClose");
  const reloadBtn = document.getElementById("zohoReload");
  const openExternal = document.getElementById("zohoOpenExternal");
  const copyBtn = document.getElementById("zohoCopyLink");
  const clearTabsBtn = document.getElementById("zohoClearTabs");
  const splitBtn = document.getElementById("zohoSplit");

  const modalTitle = document.getElementById("zohoModalTitle");

  const sidebar = document.getElementById("zohoSidebar");
  const sidebarList = document.getElementById("zohoSidebarList");
  const sidebarBackdrop = document.getElementById("zohoSidebarBackdrop");
  const toggleMenuBtn = document.getElementById("zohoToggleMenu");
  const searchInput = document.getElementById("zohoSearch");
  const sideStatus = document.getElementById("zohoSideStatus");

  const tabsBar = document.getElementById("zohoTabs");
  const splitWrap = document.getElementById("splitWrap");

  const paneA = document.getElementById("paneA");
  const paneB = document.getElementById("paneB");

  const frameA = document.getElementById("zohoFrameA");
  const frameB = document.getElementById("zohoFrameB");

  const paneATitle = document.getElementById("paneATitle");
  const paneBTitle = document.getElementById("paneBTitle");

  const paneAOpen = document.getElementById("paneAOpen");
  const paneBOpen = document.getElementById("paneBOpen");

  const paneAReload = document.getElementById("paneAReload");
  const paneBReload = document.getElementById("paneBReload");

  const fallbackA = document.getElementById("fallbackA");
  const fallbackB = document.getElementById("fallbackB");
  const fallbackAOpen = document.getElementById("fallbackAOpen");
  const fallbackBOpen = document.getElementById("fallbackBOpen");

  // Sidebar view buttons
  const viewAllBtn = document.getElementById("viewAll");
  const viewFavBtn = document.getElementById("viewFav");
  const viewRecentBtn = document.getElementById("viewRecent");
  const clearRecentBtn = document.getElementById("clearRecent");

  // Storage keys
  const LS_TABS = "osd9tdj_zoho_tabs_v1";
  const LS_ACTIVE = "osd9tdj_zoho_active_v1";
  const LS_FAV = "osd9tdj_zoho_fav_v1";
  const LS_RECENT = "osd9tdj_zoho_recent_v1";
  const LS_SPLIT = "osd9tdj_zoho_split_v1";
  const LS_PANE_A = "osd9tdj_zoho_paneA_v1";
  const LS_PANE_B = "osd9tdj_zoho_paneB_v1";

  // State
  let allItems = []; // {title,url,group}
  let tabs = [];     // {id,title,url}
  let activeTabId = null;
  let split = false;

  let paneAState = { url:null, title:"Pane A" };
  let paneBState = { url:null, title:"Pane B" };

  let fav = new Set();     // urls
  let recent = [];         // [{url,title,ts}...]

  let sidebarMode = "all"; // all | fav | recent

  // Helpers
  const isInternalLink = (url) => {
    if (!url) return true;
    return (
      url.startsWith("#") ||
      url.endsWith(".html") ||
      url.startsWith("index") ||
      url.startsWith("documents-internes")
    );
  };
  const isZoho = (url) => /zoho|zohopublic\.eu/i.test(url || "");

  function escapeHtml(s){
    return (s || "").replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }

  function safeParse(json, fallback){
    try{ return JSON.parse(json); }catch(e){ return fallback; }
  }

  function saveState(){
    try{
      localStorage.setItem(LS_TABS, JSON.stringify(tabs));
      localStorage.setItem(LS_ACTIVE, JSON.stringify(activeTabId));
      localStorage.setItem(LS_FAV, JSON.stringify(Array.from(fav)));
      localStorage.setItem(LS_RECENT, JSON.stringify(recent));
      localStorage.setItem(LS_SPLIT, JSON.stringify(split));
      localStorage.setItem(LS_PANE_A, JSON.stringify(paneAState));
      localStorage.setItem(LS_PANE_B, JSON.stringify(paneBState));
    }catch(e){}
  }

  function loadState(){
    tabs = safeParse(localStorage.getItem(LS_TABS), []);
    activeTabId = safeParse(localStorage.getItem(LS_ACTIVE), null);
    fav = new Set(safeParse(localStorage.getItem(LS_FAV), []));
    recent = safeParse(localStorage.getItem(LS_RECENT), []);
    split = !!safeParse(localStorage.getItem(LS_SPLIT), false);
    paneAState = safeParse(localStorage.getItem(LS_PANE_A), { url:null, title:"Pane A" });
    paneBState = safeParse(localStorage.getItem(LS_PANE_B), { url:null, title:"Pane B" });
  }

  function openModal(){
    modal.classList.add("open");
    modal.setAttribute("aria-hidden","false");
  }
  function closeModal(){
    modal.classList.remove("open");
    modal.setAttribute("aria-hidden","true");
    closeSidebarMobile();
  }

  function openSidebarMobile(){
    sidebar.classList.add("open");
    sidebarBackdrop.classList.add("open");
    sidebarBackdrop.setAttribute("aria-hidden","false");
  }
  function closeSidebarMobile(){
    sidebar.classList.remove("open");
    sidebarBackdrop.classList.remove("open");
    sidebarBackdrop.setAttribute("aria-hidden","true");
  }

  toggleMenuBtn.addEventListener("click", () => {
    if (sidebar.classList.contains("open")) closeSidebarMobile();
    else openSidebarMobile();
  });
  sidebarBackdrop.addEventListener("click", closeSidebarMobile);

  // ‚úÖ IMPORTANT : updatePane doit exister avant applySplit l‚Äôappelle
  function updatePane(which){
    const st = (which === "A") ? paneAState : paneBState;

    const titleEl = (which === "A") ? paneATitle : paneBTitle;
    const openEl  = (which === "A") ? paneAOpen  : paneBOpen;
    const fbOpen  = (which === "A") ? fallbackAOpen : fallbackBOpen;

    titleEl.textContent = st.title || ("Pane " + which);
    openEl.href = st.url || "#";
    fbOpen.href = st.url || "#";
  }

  // Split toggle
  function applySplit(){
    splitBtn.setAttribute("aria-pressed", split ? "true" : "false");
    if (split){
      splitWrap.classList.add("split");
      paneB.style.display = "";
    }else{
      splitWrap.classList.remove("split");
      paneB.style.display = "none";
    }

    // ‚úÖ mises √† jour UI panes
    updatePane("A");
    updatePane("B");
    saveState();
  }

  // --- Fallback (heuristique iframe bloqu√©e) ---
  let timerA = null;
  let timerB = null;

  function scheduleFallback(which){
    const st = (which === "A") ? paneAState : paneBState;
    const fb = (which === "A") ? fallbackA : fallbackB;

    if (which === "A") clearTimeout(timerA);
    else clearTimeout(timerB);

    if (!st.url || !isZoho(st.url)){
      fb.hidden = true;
      return;
    }

    const t = setTimeout(() => {
      fb.hidden = false;
    }, 1500);

    if (which === "A") timerA = t;
    else timerB = t;
  }

  frameA.addEventListener("load", () => {
    clearTimeout(timerA);
    setTimeout(() => { fallbackA.hidden = true; }, 450);
  });
  frameB.addEventListener("load", () => {
    clearTimeout(timerB);
    setTimeout(() => { fallbackB.hidden = true; }, 450);
  });

  // Boutons "Rester" des fallbacks
  document.addEventListener("click", (e) => {
    const hideId = e.target?.getAttribute?.("data-hide");
    if (hideId){
      const el = document.getElementById(hideId);
      if (el) el.hidden = true;
    }
  });

  // --- Ouverture dans une pane ---
  function setPane(which, url, title){
    if (!url) return;

    const st = (which === "A") ? paneAState : paneBState;
    const fr = (which === "A") ? frameA : frameB;
    const fb = (which === "A") ? fallbackA : fallbackB;

    st.url = url;
    st.title = title || ("Pane " + which);

    fb.hidden = true;
    fr.src = url;

    updatePane(which);
    scheduleFallback(which);

    openExternal.href = url;
    openModal();

    touchRecent(url, title);
    saveState();
  }

  // Reload panes
  paneAReload.addEventListener("click", () => {
    if (!paneAState.url) return;
    fallbackA.hidden = true;
    frameA.src = paneAState.url;
    scheduleFallback("A");
  });
  paneBReload.addEventListener("click", () => {
    if (!paneBState.url) return;
    fallbackB.hidden = true;
    frameB.src = paneBState.url;
    scheduleFallback("B");
  });

  // Reload global
  reloadBtn.addEventListener("click", () => {
    if (paneAState.url){
      fallbackA.hidden = true;
      frameA.src = paneAState.url;
      scheduleFallback("A");
    }
    if (split && paneBState.url){
      fallbackB.hidden = true;
      frameB.src = paneBState.url;
      scheduleFallback("B");
    }
  });

  // Modal close actions (si pr√©sents dans ton HTML)
  closeBtn.addEventListener("click", closeModal);
  modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
  document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

  // Copy
  copyBtn?.addEventListener("click", async () => {
    const url = paneAState.url || tabs.find(t => t.id === activeTabId)?.url || openExternal.href;
    if (!url || url === "#") return;
    try{ await navigator.clipboard.writeText(url); }catch(e){ prompt("Copie ce lien :", url); }
  });

  // --- Tabs ---
  function makeId(str){
    return (str || "").toLowerCase()
      .replace(/\s+/g,"-")
      .replace(/[^a-z0-9\-]/g,"")
      .slice(0,60) || ("doc-"+Math.random().toString(16).slice(2));
  }

  function addOrActivateTab(url, title, forceNew=false){
    if (!url) return;

    if (!forceNew){
      const existing = tabs.find(t => t.url === url);
      if (existing){
        activeTabId = existing.id;
        setPane("A", existing.url, existing.title);
        renderTabs();
        highlightSidebarActive();
        return;
      }
    }

    const id = makeId(title + "-" + url + "-" + (forceNew ? Date.now() : ""));
    tabs.unshift({ id, title: title || "Document", url });
    activeTabId = id;

    setPane("A", url, title);
    renderTabs();
    highlightSidebarActive();
  }

  function removeTab(id){
    const idx = tabs.findIndex(t => t.id === id);
    if (idx < 0) return;

    const wasActive = tabs[idx].id === activeTabId;
    tabs.splice(idx, 1);

    if (!tabs.length){
      activeTabId = null;
      renderTabs();
      highlightSidebarActive();
      saveState();
      return;
    }

    if (wasActive){
      activeTabId = tabs[0].id;
      setPane("A", tabs[0].url, tabs[0].title);
    }

    renderTabs();
    highlightSidebarActive();
    saveState();
  }

  function renderTabs(){
    if (!tabsBar) return;
    tabsBar.innerHTML = "";
    tabs.forEach(t => {
      const el = document.createElement("div");
      el.className = "tab" + (t.id === activeTabId ? " active" : "");
      el.setAttribute("role","button");
      el.setAttribute("tabindex","0");
      el.innerHTML = `<span>${escapeHtml(t.title)}</span><span class="x" title="Fermer">√ó</span>`;

      el.addEventListener("click", (e) => {
        if (e.target && e.target.classList.contains("x")){
          e.stopPropagation();
          removeTab(t.id);
          return;
        }
        activeTabId = t.id;
        setPane("A", t.url, t.title);
        renderTabs();
        highlightSidebarActive();
        saveState();
      });

      el.addEventListener("keydown",(e)=>{
        if(e.key==="Enter" || e.key===" "){
          e.preventDefault();
          activeTabId = t.id;
          setPane("A", t.url, t.title);
          renderTabs();
          highlightSidebarActive();
          saveState();
        }
      });

      tabsBar.appendChild(el);
    });
  }

  clearTabsBtn?.addEventListener("click", () => {
    tabs = [];
    activeTabId = null;
    renderTabs();
    highlightSidebarActive();
    saveState();
  });

  // --- Favoris / R√©cents ---
  function touchRecent(url, title){
    if (!url) return;
    const now = Date.now();
    recent = recent.filter(x => x.url !== url);
    recent.unshift({ url, title: title || "Document", ts: now });
    recent = recent.slice(0, 20);
    saveState();
    if (sidebarMode === "recent") renderSidebar();
  }

  function toggleFav(url){
    if (!url) return;
    if (fav.has(url)) fav.delete(url);
    else fav.add(url);
    saveState();
    renderSidebar();
  }

  clearRecentBtn?.addEventListener("click", () => {
    recent = [];
    saveState();
    if (sidebarMode === "recent") renderSidebar();
  });

  function setMode(mode){
    sidebarMode = mode;
    viewAllBtn?.setAttribute("aria-pressed", mode === "all" ? "true" : "false");
    viewFavBtn?.setAttribute("aria-pressed", mode === "fav" ? "true" : "false");
    viewRecentBtn?.setAttribute("aria-pressed", mode === "recent" ? "true" : "false");
    renderSidebar();
  }
  viewAllBtn?.addEventListener("click", () => setMode("all"));
  viewFavBtn?.addEventListener("click", () => setMode("fav"));
  viewRecentBtn?.addEventListener("click", () => setMode("recent"));

  // --- Sidebar : collecte & rendu ---
  function collectAllItems(){
    const links = Array.from(document.querySelectorAll('a[href]'))
      .map(a => ({ el: a, url: a.getAttribute("href") }))
      .filter(x => x.url && isZoho(x.url) && !isInternalLink(x.url));

    allItems = links.map(x => {
      const card = x.el.closest(".card");
      const title =
        card?.querySelector("h3")?.textContent?.trim() ||
        x.el.textContent?.trim() ||
        "Document";

      const sub = x.el.closest(".subacc")?.querySelector("summary span")?.textContent?.trim() || "";
      const acc = x.el.closest(".accordion")?.querySelector("summary span")?.textContent?.trim() || "";
      const group = [acc, sub].filter(Boolean).join(" ¬∑ ") || "Documents";

      return { title, url: x.url, group };
    });
  }

  function filteredItems(){
    const q = (searchInput?.value || "").trim().toLowerCase();

    if (sidebarMode === "fav"){
      return allItems.filter(it => fav.has(it.url))
        .filter(it => !q || (it.title || "").toLowerCase().includes(q));
    }

    if (sidebarMode === "recent"){
      const out = [];
      recent.forEach(r => {
        const it = allItems.find(x => x.url === r.url) || { title:r.title, url:r.url, group:"R√©cents" };
        if (!q || (it.title || "").toLowerCase().includes(q)) out.push(it);
      });
      return out;
    }

    return allItems
      .filter(it => !q || (it.title || "").toLowerCase().includes(q));
  }

  function renderSidebar(){
    if (!sidebarList) return;
    const items = filteredItems();

    const byGroup = new Map();
    items.forEach(it => {
      const g = it.group || "Documents";
      if (!byGroup.has(g)) byGroup.set(g, []);
      byGroup.get(g).push(it);
    });

    sidebarList.innerHTML = "";

    for (const [group, arr] of byGroup.entries()){
      const gEl = document.createElement("div");
      gEl.className = "sidebar-group";
      gEl.textContent = group;
      sidebarList.appendChild(gEl);

      arr.forEach(it => {
        const row = document.createElement("div");
        row.className = "sidebar-item";

        const main = document.createElement("button");
        main.type = "button";
        main.className = "sidebar-link";
        main.dataset.url = it.url;
        main.dataset.title = it.title;

        const star = fav.has(it.url) ? "‚≠ê" : "‚òÜ";
        main.innerHTML = `${escapeHtml(it.title)} <span style="opacity:0.75; font-weight:900;">${star}</span>`;
        main.addEventListener("click", () => {
          addOrActivateTab(it.url, it.title, false);
          closeSidebarMobile();
        });

        const btnA = document.createElement("button");
        btnA.type = "button";
        btnA.className = "sidebar-mini";
        btnA.title = "Ouvrir dans Pane A";
        btnA.textContent = "A";
        btnA.addEventListener("click", (e) => {
          e.stopPropagation();
          setPane("A", it.url, it.title);
          addOrActivateTab(it.url, it.title, false);
          closeSidebarMobile();
        });

        const btnB = document.createElement("button");
        btnB.type = "button";
        btnB.className = "sidebar-mini";
        btnB.title = split ? "Ouvrir dans Pane B" : "Active Split pour Pane B";
        btnB.textContent = "B";
        btnB.addEventListener("click", (e) => {
          e.stopPropagation();
          if (!split){
            split = true;
            applySplit();
          }
          setPane("B", it.url, it.title);
          closeSidebarMobile();
        });

        const plus = document.createElement("button");
        plus.type = "button";
        plus.className = "sidebar-mini";
        plus.title = "Ouvrir en + onglet interne";
        plus.textContent = "+";
        plus.addEventListener("click", (e) => {
          e.stopPropagation();
          addOrActivateTab(it.url, it.title, true);
          closeSidebarMobile();
        });

        const ext = document.createElement("button");
        ext.type = "button";
        ext.className = "sidebar-mini";
        ext.title = "Ouvrir Zoho direct (nouvelle fen√™tre)";
        ext.textContent = "‚Üó";
        ext.addEventListener("click", (e) => {
          e.stopPropagation();
          window.open(it.url, "_blank", "noopener,noreferrer");
        });

        const favBtn = document.createElement("button");
        favBtn.type = "button";
        favBtn.className = "sidebar-mini";
        favBtn.title = "Ajouter/retirer des favoris";
        favBtn.textContent = fav.has(it.url) ? "‚≠ê" : "‚òÜ";
        favBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          toggleFav(it.url);
        });

        row.appendChild(main);
        row.appendChild(btnA);
        row.appendChild(btnB);
        row.appendChild(plus);
        row.appendChild(ext);
        row.appendChild(favBtn);

        sidebarList.appendChild(row);
      });
    }

    highlightSidebarActive();
  }

  function highlightSidebarActive(){
    const activeUrl =
      (tabs.find(t => t.id === activeTabId)?.url) ||
      paneAState.url ||
      null;

    sidebarList?.querySelectorAll(".sidebar-link").forEach(btn => {
      btn.classList.toggle("active", !!activeUrl && btn.dataset.url === activeUrl);
    });
  }

  searchInput?.addEventListener("input", renderSidebar);

  // Interception des liens Zoho des cartes
  document.querySelectorAll('a[href*="zohopublic.eu"], a[href*="zoho"]').forEach(a => {
    const url = a.getAttribute("href");
    if (!url || isInternalLink(url)) return;

    a.addEventListener("click", (e) => {
      e.preventDefault();
      const title =
        a.closest(".card")?.querySelector("h3")?.textContent?.trim()
        || a.textContent.trim()
        || "Documents";

      addOrActivateTab(url, title, false);
    });
  });

  // --- Init ---
  loadState();
  collectAllItems();
  applySplit();

  updatePane("A");
  updatePane("B");
  renderTabs();
  setMode("all");
  renderSidebar();
  highlightSidebarActive();

  // Optionnel : restaurer derni√®re vue
  if (paneAState.url) setPane("A", paneAState.url, paneAState.title);
  if (split && paneBState.url) setPane("B", paneBState.url, paneBState.title);

  // On ferme la modale apr√®s restauration auto (sinon elle s‚Äôouvre au chargement)
  closeModal();

  window.addEventListener("beforeunload", saveState);
</script>
</body>
</html>
