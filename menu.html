<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <title>Menu de navigation | OSD9TDJ</title>
  <meta name="description" content="Menu de navigation du site O.S.D.9.T.D.J. : accès rapide aux pages principales, aux informations officielles et aux pages encyclopédiques en cours de création." />
  <meta name="keywords" content="OSD9TDJ, ordre templier, association loi 1901, templiers, histoire du Temple, adhésion, événements, boutique, membres, statuts, mentions légales, cookies, FAQ" />
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
  <meta name="author" content="O.S.D.9.T.D.J." />
  <link rel="canonical" href="https://osd9tdj.org/menu.html" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Menu de navigation | OSD9TDJ" />
  <meta property="og:description" content="Accès rapide à l’arborescence du site O.S.D.9.T.D.J." />
  <meta property="og:url" content="https://osd9tdj.org/menu.html" />
  <meta property="og:site_name" content="OSD9TDJ" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Menu de navigation | OSD9TDJ" />
  <meta name="twitter:description" content="Accès rapide à l’arborescence du site O.S.D.9.T.D.J." />

  <meta name="generator" content="OSD9TDJ - Menu de navigation" />
  <meta name="application-name" content="OSD9TDJ" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">

  <!-- JSON-LD principal (inchangé) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@graph":[
      {"@type":"Organization","@id":"https://osd9tdj.org/#org","name":"O.S.D.9.T.D.J.","url":"https://osd9tdj.org/","logo":"https://osd9tdj.org/sceaudeux.PNG","description":"Association loi 1901 – site officiel O.S.D.9.T.D.J."},
      {"@type":"WebSite","@id":"https://osd9tdj.org/#website","url":"https://osd9tdj.org/","name":"OSD9TDJ","publisher":{"@id":"https://osd9tdj.org/#org"},"inLanguage":"fr-FR"},
      {"@type":"WebPage","@id":"https://osd9tdj.org/menu.html#webpage","url":"https://osd9tdj.org/menu.html","name":"Menu de navigation | OSD9TDJ","isPartOf":{"@id":"https://osd9tdj.org/#website"},"about":{"@id":"https://osd9tdj.org/#org"},"inLanguage":"fr-FR"},
      {"@type":"SiteNavigationElement","@id":"https://osd9tdj.org/menu.html#nav","name":"Menu de navigation","url":"https://osd9tdj.org/menu.html","inLanguage":"fr-FR"}
    ]
  }
  </script>

  <!-- SEO "étoiles" (à remplir avec tes VRAIES valeurs si tu veux) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "@id":"https://osd9tdj.org/#org",
    "name":"O.S.D.9.T.D.J.",
    "url":"https://osd9tdj.org/",
    "logo":"https://osd9tdj.org/sceaudeux.PNG",
    "aggregateRating":{
      "@type":"AggregateRating",
      "ratingValue":"5",
      "bestRating":"5",
      "ratingCount":"5"
    }
  }
  </script>

  <style>
  :root{
    /* voile global (fond derrière menu) : noir MAIS léger */
    --veil: rgba(0,0,0,.18);

    --panelW: min(560px, 92vw);
    --panelH: min(92vh, 920px);
    --radius: 18px;

    /* texte */
    --txt: rgba(255,255,255,.96);
    --txt2: rgba(255,255,255,.88);
    --red: #a11212;

    --line: rgba(255,255,255,.18);

    /* voiles sous textes (cartes) : noirs translucides, pas trop sombres */
    --card: rgba(0,0,0,.28);
    --card2: rgba(0,0,0,.34);

    --btn: rgba(0,0,0,.28);
    --btn2: rgba(0,0,0,.42);

    --slideDur: 4.8s;
    --edge: clamp(10px, 3vw, 28px);
  }

  html,body{height:100%; margin:0;}
  body{
    font-family: "Uncial Antiqua", ui-serif, Georgia, "Times New Roman", serif;
    color: var(--txt);

    background:
      linear-gradient(to bottom, rgba(0,0,0,.30), rgba(0,0,0,.08)),
      url("menu.png") center/cover no-repeat fixed;

    overflow:hidden;
  }

  /* ancienne page derrière */
  .bgFrame{
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    border:0;
    z-index:0;
    filter: blur(1.2px);
    transform: scale(1.01);
    pointer-events:none;
    background:#000;
  }

  /* Watermark visible DISCRET (derrière le voile et le panneau, ne gêne jamais) */
  .wmOverlay{
    position:fixed;
    inset:0;
    z-index:5;              /* derrière le voile (10) et panel (20) */
    pointer-events:none;
    opacity:.10;
    mix-blend-mode: overlay;
    background-image:
      repeating-linear-gradient(
        -28deg,
        rgba(255,255,255,.22) 0px,
        rgba(255,255,255,.22) 1px,
        transparent 1px,
        transparent 220px
      );
  }
  .wmOverlay::before{
    content:"O.S.D.9.T.D.J. • osd9tdj.org • contenus originaux •";
    position:absolute;
    left:50%;
    top:50%;
    transform: translate(-50%,-50%) rotate(-22deg);
    font-size: clamp(14px, 2.1vw, 26px);
    letter-spacing:.9px;
    white-space:nowrap;
    color: rgba(255,255,255,.28);
    text-shadow: 0 2px 14px rgba(0,0,0,.55);
  }

  /* voile au-dessus du fond */
  .veil{
    position:fixed; inset:0;
    background: var(--veil);
    backdrop-filter: blur(1.4px);
    -webkit-backdrop-filter: blur(1.4px);
    z-index:10;
    pointer-events:auto;
  }

  .panel{
    position:fixed;
    top: 50%;
    left: var(--edge);
    transform: translate(-130%, -50%);
    width: var(--panelW);
    height: var(--panelH);
    z-index: 20;

    border-radius: var(--radius);
    box-shadow: 0 26px 80px rgba(0,0,0,.55);
    overflow:hidden;

    background:
      linear-gradient(to bottom, rgba(0,0,0,.18), rgba(0,0,0,.08)),
      url("menu.png") center/cover no-repeat;

    outline: 1px solid rgba(255,255,255,.10);
  }

  .panel.open{
    animation: slideToRight var(--slideDur) cubic-bezier(.18,.92,.18,1) forwards;
  }

  @keyframes slideToRight{
    0%{ transform: translate(-130%, -50%); }
    100%{ transform: translate(calc(100vw - var(--panelW) - var(--edge)), -50%); }
  }

  /* ✅ FIX HAUTEUR (TABLETTE + PC)
     IMPORTANT : on applique le "mode plein écran vertical" dès 901px
     -> ça enlève la zone "coulissante moche" due à une hauteur limitée
     -> et on garde EXACTEMENT ton coulissage à droite */
  @media (min-width: 901px){
    :root{ --panelH: 100dvh; }

    .panel{
      top: 0;
      transform: translate(-130%, 0);
      height: var(--panelH);
    }
    .panel.open{
      animation: slideToRightDesk var(--slideDur) cubic-bezier(.18,.92,.18,1) forwards;
    }
    @keyframes slideToRightDesk{
      0%{ transform: translate(-130%, 0); }
      100%{ transform: translate(calc(100vw - var(--panelW) - var(--edge)), 0); }
    }
  }

  /* ======== IMPORTANT: contenu caché pendant la coulisse ======== */
  .panel .header,
  .panel .scroll{
    opacity: 0;
    transform: translateX(-18px);
    transition: opacity .55s ease, transform .55s ease;
  }
  .panel.ready .header,
  .panel.ready .scroll{
    opacity: 1;
    transform: translateX(0);
  }

  .header{
    position:sticky; top:0;
    padding: 18px 18px 12px 18px;
    display:flex; align-items:flex-start; justify-content:space-between;
    gap: 12px;

    /* header noir léger pour laisser voir l'image */
    background: linear-gradient(to bottom, rgba(0,0,0,.42), rgba(0,0,0,.18));
    border-bottom: 1px solid rgba(255,255,255,.14);
    z-index: 30;
  }

  .title{
    font-size: 28px;
    line-height:1.05;
    letter-spacing:.4px;
    margin:0;
    color: var(--txt);
    text-shadow: 0 2px 10px rgba(0,0,0,.65);
  }

  .first{
    color: var(--red);
    font-weight: 700;
    margin-right: 0;
    text-shadow: 0 0 10px rgba(161,18,18,.55), 0 2px 10px rgba(0,0,0,.65);
  }

  .actions{ display:flex; gap:10px; align-items:center; }
  .btn{
    appearance:none; border:0;
    padding: 10px 12px;
    border-radius: 12px;
    background: var(--btn);
    outline: 1px solid rgba(255,255,255,.18);
    color: var(--txt);
    font-weight: 700;
    cursor:pointer;
    user-select:none;
    font-family: "Uncial Antiqua", ui-serif, Georgia, "Times New Roman", serif;
    text-shadow: 0 2px 10px rgba(0,0,0,.6);
  }
  .btn:hover{ background: var(--btn2); }
  .btn.close{
    width: 42px; height: 42px;
    display:grid; place-items:center;
    font-size: 18px;
    padding:0;
  }

  .scroll{
    height: calc(var(--panelH) - 84px);
    overflow:auto;
    padding: 14px 16px calc(190px + env(safe-area-inset-bottom)) 16px;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,.35) transparent;
  }

  details.group{
    border-radius: 16px;
    background: var(--card);
    outline: 1px solid rgba(255,255,255,.14);
    margin: 10px 0;
    overflow:hidden;
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
  }

  summary{
    list-style:none;
    display:flex; align-items:center; justify-content:space-between;
    gap:10px;
    padding: 14px 14px;
    cursor:pointer;
    user-select:none;
    background: rgba(0,0,0,.22);
    border-bottom: 1px dashed rgba(255,255,255,.16);
  }
  summary::-webkit-details-marker{ display:none; }

  .label{
    font-size: 20px;
    font-weight: 800;
    letter-spacing:.3px;
    color: var(--txt);
    text-shadow: 0 2px 10px rgba(0,0,0,.65);
  }

  .chev{
    width: 34px; height: 34px;
    border-radius: 12px;
    background: rgba(0,0,0,.18);
    outline: 1px solid rgba(255,255,255,.16);
    display:grid; place-items:center;
    flex: 0 0 auto;
    color: var(--txt);
  }
  .chev svg{ width:18px; height:18px; opacity:.90; }
  details[open] .chev svg{ transform: rotate(180deg); transition: transform .22s ease; }

  .items{
    padding: 10px 12px 12px 12px;
    display:grid;
    gap: 10px;
  }

  a.item{
    display:flex; align-items:center; justify-content:space-between;
    gap: 12px;
    padding: 12px 12px;
    border-radius: 14px;
    text-decoration:none;
    color: var(--txt2);
    background: rgba(0,0,0,.20);
    outline: 1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
  }
  a.item:hover{ background: rgba(0,0,0,.30); color: var(--txt); }

  .sub{ font-size: 18px; font-weight: 700; letter-spacing:.2px; }

  .lock{
    width: 20px; height: 20px; flex:0 0 auto;
    opacity:.9;
    filter: drop-shadow(0 2px 2px rgba(0,0,0,.35));
  }

  /* reveal texte (inchangé mais on déclenche après coulisse) */
  .write{
    display:inline-block;
    overflow:hidden;
    vertical-align:bottom;
    clip-path: inset(0 100% 0 0);
  }
  .write.reveal{ animation: inkReveal var(--dur, 2600ms) linear forwards; }
  @keyframes inkReveal{ to{ clip-path: inset(0 0 0 0); } }

  .sealDock{
    position: relative;
    display:flex;
    justify-content:center;
    margin: 34px 0 0 0;
    padding: 26px 2px calc(18px + env(safe-area-inset-bottom)) 2px;
    pointer-events:none;
  }

  .sealDock::before{
    content:"";
    position:absolute;
    left: 12px; right: 12px;
    top: 14px;
    height: 190px;
    border-radius: 32px;
    filter: blur(14px);
    opacity: .70;
    background: radial-gradient(
      ellipse at center,
      rgba(0,0,0,.22) 0%,
      rgba(0,0,0,.10) 55%,
      rgba(0,0,0,0) 100%
    );
    pointer-events:none;
  }

  .seal{
    position: relative;
    width: clamp(220px, 32vw, 320px);
    height:auto;
    opacity:0;
    transition: opacity .45s ease;
    filter: drop-shadow(0 14px 26px rgba(0,0,0,.45));
  }
  .seal.show{ opacity:1; }

  /* watermark invisible renforcé */
  .wm{
    position:absolute;
    left:-9999px;
    top:auto;
    width:1px; height:1px;
    overflow:hidden;
    opacity:0.001;
    pointer-events:none;
    user-select:none;
  }

  /* Landscape compact : UNIQUEMENT petits écrans (mobile) */
  @media (max-width: 900px) and (orientation: landscape){
    :root{
      --panelW: min(620px, 70vw);
      --panelH: min(88vh, 720px);
    }
    .title{ font-size: 26px; }
    .label{ font-size: 19px; }
    .sub{ font-size: 17px; }
  }
  </style>
</head>

<body>
  <!-- watermark invisible renforcé -->
  <div class="wm" aria-hidden="true">
    O.S.D.9.T.D.J. — osd9tdj.org — Menu de navigation — Association loi 1901 — contenus originaux — empreinte site.
    © OSD9TDJ. Toute reproduction, extraction ou réutilisation sans autorisation est interdite.
    Signature: OSD9TDJ|MENU|v1|{{ts}}
  </div>

  <iframe class="bgFrame" id="bgFrame" title="Page précédente (floutée)" aria-hidden="true"></iframe>

  <!-- watermark visible discret -->
  <div class="wmOverlay" aria-hidden="true"></div>

  <div class="veil" id="veil" aria-hidden="true"></div>

  <main class="panel" id="panel" role="dialog" aria-modal="true" aria-label="Menu de navigation">
    <header class="header">
      <h1 class="title" id="menuTitle">Menu de navigation</h1>
      <div class="actions">
        <button class="btn" id="btnBack" type="button">← Revenir</button>
        <button class="btn close" id="btnClose" type="button" aria-label="Fermer">✕</button>
      </div>
    </header>

    <section class="scroll" id="scroll">
      <details class="group">
        <summary>
          <div class="label js-write">Général</div>
          <div class="chev" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </summary>
        <div class="items">
          <a class="item" href="index.html"><span class="sub js-write">Accueil</span></a>
          <a class="item" href="quinoussommes.html"><span class="sub js-write">Qui nous sommes</span></a>
          <a class="item" href="notre-mission.html"><span class="sub js-write">Notre mission</span></a>
          <a class="item" href="histoire.html"><span class="sub js-write">Notre histoire</span></a>
          <a class="item" href="embleme-et-logo.html"><span class="sub js-write">Emblèmes et logos de l'ordre</span></a>
          <a class="item" href="contact.html"><span class="sub js-write">Contact</span></a>
        </div>
      </details>

      <details class="group">
        <summary>
          <div class="label js-write">Histoire templière</div>
          <div class="chev" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </summary>
        <div class="items">
          <a class="item" href="ordres-historiques.html"><span class="sub js-write">Ordres historiques</span></a>
          <a class="item" href="vocation.html"><span class="sub js-write">Histoire du Temple</span></a>
          <a class="item" href="commanderies.html"><span class="sub js-write">Commanderies et dignitaires de l’Ordre du Temple</span></a>
          <a class="item" href="bernard.html"><span class="sub js-write">Bernard de Clairvaux</span></a>
        </div>
      </details>

      <details class="group">
        <summary>
          <div class="label js-write">Activités &amp; événements</div>
          <div class="chev" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </summary>
        <div class="items">
          <a class="item" href="activites.html"><span class="sub js-write">Nos événements</span></a>
        </div>
      </details>

      <details class="group">
        <summary>
          <div class="label js-write">Adhésion</div>
          <div class="chev" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </summary>
        <div class="items">
          <a class="item" href="adhesion.html"><span class="sub js-write">Adhésion</span></a>
          <a class="item" href="cotisations.html"><span class="sub js-write">Cotisations</span></a>
          <a class="item" href="notice-adhesion.html"><span class="sub js-write">Procédure d’adhésion</span></a>
          <a class="item" href="commanderie.html"><span class="sub js-write">Ouvrir une commanderie</span></a>
        </div>
      </details>

      <details class="group">
        <summary>
          <div class="label js-write">Boutique</div>
          <div class="chev" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </summary>
        <div class="items">
          <a class="item" href="boutique.html"><span class="sub js-write">Boutique</span></a>
        </div>
      </details>

      <details class="group">
        <summary>
          <div class="label js-write">Membres</div>
          <div class="chev" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </summary>
        <div class="items">
          <a class="item" href="documents-internes.html">
            <span class="sub js-write">Accès réservé aux membres</span>
            <svg class="lock" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 11h12v10H6V11Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M12 15v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </a>

          <a class="item" href="administration.html">
            <span class="sub js-write">Administration</span>
            <svg class="lock" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 11h12v10H6V11Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M12 15v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </a>
        </div>
      </details>

      <details class="group">
        <summary>
          <div class="label js-write">Informations officielles &amp; aide</div>
          <div class="chev" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </summary>
        <div class="items">
          <a class="item" href="statuts.html"><span class="sub js-write">Statuts</span></a>
          <a class="item" href="mentions.html"><span class="sub js-write">Mentions / informations officielles</span></a>
          <a class="item" href="assurance.html"><span class="sub js-write">Assurance</span></a>
          <a class="item" href="cookies.html"><span class="sub js-write">Cookies</span></a>
          <a class="item" href="faq.html"><span class="sub js-write">FAQ</span></a>
        </div>
      </details>

      <details class="group">
        <summary>
          <div class="label js-write">Encyclopédique </div>
          <div class="chev" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </summary>
        <div class="items">
          <a class="item" href="Wikipedia.html"><span class="sub js-write">Page encyclopédique</span></a>
        </div>
      </details>

      <div style="display:flex; justify-content:center; margin: 14px 0 8px 0;">
        <button class="btn" id="btnBack2" type="button">
          ← Revenir à la page précédente
        </button>
      </div>

      <div class="sealDock" aria-hidden="true">
        <img id="seal" class="seal" src="sceaudeux.PNG" alt="Sceau OSD9TDJ">
      </div>
    </section>
  </main>

  <!-- Audio global -->
  <script defer src="/osd.js"></script>

  <script>
    /* sons locaux (plume + tampon) */
    const SOUND_PLUME  = "sons/plume.mp3";
    const SOUND_TAMPON = "sons/tampon.mp3";

    let audioReady = false;
    let aPlume, aTampon;

    function initAudioOnce(){
      if (audioReady) return;
      try{
        aPlume  = new Audio(SOUND_PLUME);
        aTampon = new Audio(SOUND_TAMPON);
        [aPlume, aTampon].forEach(a => { a.preload = "auto"; a.volume = 0.85; });
        audioReady = true;
      }catch(e){}
    }

    function playSafe(a){
      if(!audioReady || !a) return;
      try{ a.currentTime = 0; a.play().catch(()=>{}); }catch(e){}
    }

    function startPlumeFor(ms){
      if(!audioReady || !aPlume) return;
      try{
        aPlume.currentTime = 0;
        aPlume.play().catch(()=>{});
        window.setTimeout(() => {
          try{ aPlume.pause(); aPlume.currentTime = 0; }catch(e){}
        }, Math.max(0, ms) + 80);
      }catch(e){}
    }

    const panel = document.getElementById("panel");
    const veil  = document.getElementById("veil");
    const seal  = document.getElementById("seal");
    const bgFrame = document.getElementById("bgFrame");

    /* fond derrière menu + mémoire tablette */
    (function setBackgroundPage(){
      try{
        const last = (() => {
          try { return sessionStorage.getItem("osd_prev_page") || ""; } catch(e) { return ""; }
        })();

        if(last && (last.startsWith(location.origin) || last.startsWith("http"))){
          bgFrame.src = last;
          return;
        }

        const ref = document.referrer || "";
        if(ref && ref.startsWith(location.origin)){
          bgFrame.src = ref;
          return;
        }

        bgFrame.src = "index.html";
      }catch(e){
        bgFrame.src = "index.html";
      }
    })();

    function goBack(){
      // priorité: sessionStorage.osd_prev_page (fiable tablette)
      try{
        const last = sessionStorage.getItem("osd_prev_page") || "";
        if(last && (last.startsWith(location.origin) || last.startsWith("http"))){
          window.location.href = last;
          return;
        }
      }catch(e){}

      // fallback
      if (document.referrer && document.referrer.includes(location.hostname)) {
        window.location.href = document.referrer;
      } else if (history.length > 1) {
        history.back();
      } else {
        window.location.href = "index.html";
      }
    }

    function makeFirstLetterRed(node){
      const txt = (node.textContent || "").trim();
      if(!txt) return;
      if(node.dataset.firstDone) return;
      node.dataset.firstDone = "1";

      const first = txt[0];
      const rest  = txt.slice(1);

      node.textContent = "";
      const s1 = document.createElement("span");
      s1.className = "first";
      s1.textContent = first;

      const s2 = document.createElement("span");
      s2.textContent = rest;

      node.appendChild(s1);
      node.appendChild(s2);
    }

    function applyWriting(){
      const els = document.querySelectorAll(".js-write, .title");
      let maxDur = 2600;

      els.forEach(el => {
        makeFirstLetterRed(el);

        if(el.dataset.writeDone) return;
        el.dataset.writeDone = "1";

        const wrap = document.createElement("span");
        wrap.className = "write";
        while(el.firstChild) wrap.appendChild(el.firstChild);
        el.appendChild(wrap);

        const text = wrap.textContent.trim();
        const dur = Math.max(2400, Math.min(7200, text.length * 140));
        wrap.style.setProperty("--dur", dur + "ms");
        if(dur > maxDur) maxDur = dur;
      });

      // reveal
      setTimeout(() => {
        document.querySelectorAll(".write").forEach(w => w.classList.add("reveal"));
        startPlumeFor(maxDur);
      }, 180);
    }

    function cssVarToMs(varName, fallbackMs){
      try{
        const v = getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
        if(!v) return fallbackMs;
        if(v.endsWith("ms")) return parseFloat(v);
        if(v.endsWith("s"))  return parseFloat(v) * 1000;
        return fallbackMs;
      }catch(e){
        return fallbackMs;
      }
    }

    function openMenu(){
      panel.classList.add("open");
      initAudioOnce();

      const slideMs = cssVarToMs("--slideDur", 4800);

      // 1) panneau coulisse vide
      // 2) après la coulisse: on affiche header/scroll + on lance l'écriture
      setTimeout(() => {
        panel.classList.add("ready");
        applyWriting();

        setTimeout(() => {
          seal.classList.add("show");
          playSafe(aTampon);
        }, 2600);

      }, slideMs + 60);
    }

    // init plume/tampon au premier geste (si autoplay bloqué)
    document.addEventListener("pointerdown", () => { initAudioOnce(); }, { capture:true });

    document.getElementById("btnBack").addEventListener("click", goBack);
    document.getElementById("btnBack2").addEventListener("click", goBack);
    document.getElementById("btnClose").addEventListener("click", goBack);

    veil.addEventListener("click", goBack);
    panel.addEventListener("click", (e) => e.stopPropagation());

    // Watermark invisible renforcé (signature + timestamp + meta)
    (function(){
      try{
        const wm = document.querySelector(".wm");
        if(wm){
          const ts = new Date().toISOString();
          wm.textContent = wm.textContent.replace("{{ts}}", ts);

          const meta = document.createElement("meta");
          meta.name = "osd9tdj-watermark";
          meta.content = "OSD9TDJ|menu|"+ts+"|"+location.pathname;
          document.head.appendChild(meta);
        }
      }catch(e){}
    })();

    window.addEventListener("load", openMenu);
  </script>
</body>
</html>
