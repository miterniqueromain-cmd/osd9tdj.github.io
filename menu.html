<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Menu de navigation | OSD9TDJ</title>

  <!-- SEO -->
  <meta name="description" content="Menu de navigation du site officiel OSD9TDJ : accès rapide aux pages principales, informations officielles, adhésion, activités, documents et sections encyclopédiques." />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="canonical" href="https://osd9tdj.org/menu.html" />

  <!-- OpenGraph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Menu de navigation | OSD9TDJ" />
  <meta property="og:description" content="Accédez rapidement à toutes les sections du site OSD9TDJ." />
  <meta property="og:url" content="https://osd9tdj.org/menu.html" />

  <!-- Police médiévale (online) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=MedievalSharp&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#2b1a0f;
      --ink2:#3a2417;
      --red:#8b0d0d;
      --panelW: min(560px, 92vw);
      --panelH: min(92vh, 920px);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      background:#000;
      overflow:hidden;
      font-family: "MedievalSharp", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* ====== ARRIÈRE-PLAN (ancienne page) ====== */
    .behind{
      position:fixed; inset:0;
      background:#000;
    }
    .behind iframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
      filter: blur(7px) saturate(0.9) brightness(0.55);
      transform: scale(1.06); /* évite bordures au blur */
      transform-origin:center;
    }
    .behind .veil{
      position:absolute; inset:0;
      background: rgba(0,0,0,.55);
    }
    .behind .clickback{
      position:absolute; inset:0;
      cursor:pointer;
    }

    /* ====== PANNEAU PARCHEMIN (menu) ====== */
    .panel{
      position:fixed;
      left: max(14px, env(safe-area-inset-left));
      top: 50%;
      transform: translateY(-50%);
      width: var(--panelW);
      height: var(--panelH);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: 0 24px 90px rgba(0,0,0,.55);
      outline: 1px solid rgba(255,255,255,.06);

      /* fond parchemin (ton fichier) */
      background: url("parchemin.jpg") center / cover no-repeat;
      background-color: #d8c3a4;

      animation: slideIn .55s cubic-bezier(.2,.9,.2,1) both;
    }

    @keyframes slideIn{
      from{ transform: translate(-110%, -50%); opacity:.0; }
      to{ transform: translate(0, -50%); opacity:1; }
    }

    /* voile de lecture léger à l'intérieur (pas gris, pas cadre) */
    .paperShade{
      position:absolute; inset:0;
      background: radial-gradient(120% 90% at 50% 10%, rgba(0,0,0,.00) 0%, rgba(0,0,0,.07) 65%, rgba(0,0,0,.10) 100%);
      pointer-events:none;
      z-index:1;
    }

    /* contenu scrollable */
    .content{
      position:absolute; inset:0;
      padding: 18px 18px 120px 18px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      z-index:2;
    }

    /* titre */
    .titleRow{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding: 6px 4px 14px 4px;
    }
    h1{
      margin:0;
      font-family:"Uncial Antiqua", "MedievalSharp", serif;
      font-weight:400;
      color: var(--ink);
      font-size: 28px;
      letter-spacing: .3px;
      line-height:1.05;
      flex:1;
    }
    .btns{
      display:flex; gap:10px;
      align-items:center;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(0,0,0,.22);
      background: rgba(255,255,255,.18);
      color: var(--ink);
      border-radius: 12px;
      padding: 10px 12px;
      font-family:"Uncial Antiqua", serif;
      font-size: 13px;
      cursor:pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,.18);
      backdrop-filter: blur(2px);
    }
    .btn:active{ transform: translateY(1px); }

    /* sections */
    .section{
      margin-top: 12px;
    }
    details{
      border-radius: 14px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(0,0,0,.12);
      overflow:hidden;
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding: 14px 14px;
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }

    .sumText{
      font-family:"Uncial Antiqua", serif;
      font-weight:400;
      color: var(--ink);
      font-size: 18px;
      line-height:1.1;
      flex:1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* première lettre rouge (sans casser l'espacement) */
    .dropcap{
      color: var(--red);
      font-family:"Uncial Antiqua", serif;
      font-weight:400;
      display:inline; /* IMPORTANT: pas inline-block ici */
      letter-spacing: 0;
      margin:0;
      padding:0;
    }

    .chev{
      width:34px; height:34px;
      border-radius: 11px;
      border:1px solid rgba(0,0,0,.15);
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.10);
      flex:0 0 auto;
    }
    .chev svg{ width:16px; height:16px; opacity:.85; }
    details[open] .chev svg{ transform: rotate(180deg); }

    /* items */
    .items{
      padding: 8px 12px 12px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .item{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(0,0,0,.10);
      text-decoration:none;
      color: var(--ink2);
    }
    .item:hover{ background: rgba(255,255,255,.18); }

    .itemText{
      font-family:"Uncial Antiqua", serif;
      font-size:16px;
      line-height:1.1;
      flex:1;
    }
    .itemIndent{ margin-left: 18px; } /* quinconce */
    .lock{
      width:18px; height:18px;
      display:inline-grid;
      place-items:center;
      flex:0 0 auto;
      opacity:.95;
    }
    .lock svg{ width:18px; height:18px; }

    /* bouton retour dans le parchemin */
    .backRow{
      margin-top:14px;
      display:flex;
      justify-content:center;
    }
    .backBig{
      border-radius: 14px;
      padding: 12px 14px;
      border:1px solid rgba(0,0,0,.18);
      background: rgba(255,255,255,.14);
      font-family:"Uncial Antiqua", serif;
      cursor:pointer;
      color: var(--ink);
      box-shadow: 0 10px 22px rgba(0,0,0,.16);
    }

    /* ====== BAS DU PARCHEMIN: signature + sceau ====== */
    .footer{
      position:absolute;
      left:0; right:0;
      bottom:0;
      height: 110px;
      z-index:3;
      pointer-events:none; /* les éléments internes gèrent */
    }

    /* bande sombre uniquement sous la signature (pas sur le sceau) */
    .sigBand{
      position:absolute;
      left: 14px;
      right: 110px; /* laisse de l'espace pour le sceau à droite */
      bottom: 14px;
      height: 76px;
      border-radius: 16px;
      background: linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,.20));
      filter: blur(0px);
      pointer-events:none;
    }

    .sig{
      position:absolute;
      left: 22px;
      right: 118px;
      bottom: 22px;
      height: 58px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:16px;
      pointer-events:none;
    }
    .sig .sword{
      width:30px; height:30px; opacity:.9;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
    }
    .sig .name{
      font-family:"Uncial Antiqua", serif;
      font-size: 22px;
      letter-spacing: .8px;
      color: #d5b15a; /* doré lisible */
      text-shadow: 0 2px 0 rgba(0,0,0,.35);
    }

    .seal{
      position:absolute;
      right: 14px;
      bottom: 10px;
      width: 90px;
      height: 90px;
      pointer-events:none;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,.28));
      transform-origin: 80% 80%;
      opacity:0;
      transform: translateY(10px) scale(.92);
      animation: sealPop .42s ease-out forwards;
      animation-delay: 1.25s; /* après "écriture" */
    }
    @keyframes sealPop{
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    /* Watermark invisible */
    .wm{
      position:absolute; left:-9999px; top:-9999px;
      opacity:0.01;
      font-size:1px;
      pointer-events:none;
    }

    /* Réduction mouvement */
    @media (prefers-reduced-motion: reduce){
      .panel{ animation:none; }
      .seal{ animation:none; opacity:1; transform:none; }
    }

    /* Mobile */
    @media (max-width:520px){
      h1{ font-size:24px; }
      .sumText{ font-size:16px; }
      .itemText{ font-size:14px; }
      .panel{
        left: 8px;
        width: min(96vw, 560px);
        height: 94vh;
      }
      .sig .name{ font-size:20px; }
    }
  </style>

  <!-- JSON-LD (SEO/IA) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Menu de navigation | OSD9TDJ",
    "url":"https://osd9tdj.org/menu.html",
    "inLanguage":"fr",
    "isPartOf":{
      "@type":"WebSite",
      "name":"OSD9TDJ",
      "url":"https://osd9tdj.org/"
    },
    "about":{
      "@type":"Organization",
      "name":"OSD9TDJ",
      "url":"https://osd9tdj.org/",
      "logo":"https://osd9tdj.org/sceau.png"
    }
  }
  </script>
</head>

<body>
  <!-- arrière-plan = page précédente -->
  <div class="behind" aria-hidden="true">
    <iframe id="behindFrame" title="Page précédente"></iframe>
    <div class="veil"></div>
    <div class="clickback" id="clickback"></div>
  </div>

  <!-- panneau parchemin -->
  <main class="panel" role="dialog" aria-label="Menu de navigation">
    <div class="paperShade"></div>

    <div class="content" id="content">
      <div class="titleRow">
        <h1 id="title" data-write="Menu de navigation"></h1>

        <div class="btns">
          <button class="btn" id="btnBack" type="button">← Revenir</button>
          <button class="btn" id="btnClose" type="button" aria-label="Fermer">✕</button>
        </div>
      </div>

      <div id="menuRoot" class="menuRoot" aria-label="Sommaire du site"></div>

      <div class="backRow">
        <button class="backBig" id="btnBackBig" type="button">← Revenir à la page précédente</button>
      </div>

      <!-- watermark invisible -->
      <div class="wm" aria-hidden="true">
        OSD9TDJ, Ordre templier, association loi 1901, informations officielles, adhésion, cotisations,
        activités, événements, commanderies, histoire du Temple, encyclopédique (en cours de création),
        mentions légales, cookies, FAQ, contact, accès réservé aux membres.
      </div>
    </div>

    <!-- bas parchemin -->
    <div class="footer" aria-hidden="true">
      <div class="sigBand"></div>

      <div class="sig" id="sig">
        <!-- épées -->
        <svg class="sword" viewBox="0 0 64 64" aria-hidden="true">
          <path fill="#d9d9d9" d="M41 8l-3 3 8 8-3 3-8-8-3 3 6 6-18 18-8 2 2-8 18-18 6 6 3-3-8-8 3-3 8 8 3-3z"/>
          <path fill="#9a7b2f" d="M18 44l2 2-6 6-4 1 1-4z"/>
        </svg>

        <div class="name" id="nameGold">NNDNN</div>

        <svg class="sword" viewBox="0 0 64 64" aria-hidden="true">
          <path fill="#d9d9d9" d="M23 8l3 3-8 8 3 3 8-8 3 3-6 6 18 18 8 2-2-8-18-18-6 6-3-3 8-8-3-3-8 8-3-3z"/>
          <path fill="#9a7b2f" d="M46 44l-2 2 6 6 4 1-1-4z"/>
        </svg>
      </div>

      <!-- sceau (ton image) -->
      <img class="seal" src="sceau.png" alt="" />
    </div>

    <!-- Sons (mets ces fichiers mp3 à la racine) -->
    <audio id="sndOpen" src="parchemin.mp3" preload="auto"></audio>
    <audio id="sndWrite" src="plume.mp3" preload="auto"></audio>
    <audio id="sndSword" src="epee.mp3" preload="auto"></audio>
    <audio id="sndSeal" src="tampon.mp3" preload="auto"></audio>
  </main>

  <script>
    // ===== CONFIG MENU (tu ajoutes/retouches ici sans toucher le HTML) =====
    const MENU_DATA = [
      {
        title: "Général",
        items: [
          {label:"Accueil", href:"index.html"},
          {label:"Qui nous sommes", href:"quioussommes.html"},
          {label:"Notre mission", href:"notre-mission.html"},
          {label:"Contact", href:"contact.html"}
        ]
      },
      {
        title: "Histoire templière",
        items: [
          {label:"Notre histoire", href:"histoire.html"},
          {label:"Ordres historiques", href:"ordres-historiques.html"},
          {label:"Histoire du Temple", href:"vocation.html"},
          {label:"Commanderies", href:"commanderies.html"},
          {label:"Bernard de Clairvaux", href:"bernard.html"}
        ]
      },
      {
        title: "Activités & événements",
        items: [
          {label:"Nos événements", href:"activites.html"}
        ]
      },
      {
        title: "Adhésion",
        items: [
          {label:"Adhésion", href:"adhesion.html"},
          {label:"Procédure d’adhésion", href:"procedure-adhesion.html"} // à créer si besoin
        ]
      },
      {
        title: "Boutique",
        items: [
          {label:"Boutique", href:"boutique.html"}
        ]
      },
      {
        title: "Membres",
        items: [
          {label:"Accès réservé aux membres", href:"documents-internes.html", locked:true},
          {label:"Administration", href:"administration.html", locked:true}
        ]
      },
      {
        title: "Informations officielles & aide",
        items: [
          {label:"Statuts", href:"statuts.html"},
          {label:"Cotisations", href:"cotisations.html"},
          {label:"Assurance", href:"assurance.html"},
          {label:"Mentions / Informations officielles", href:"mentions.html"},
          {label:"Cookies", href:"cookies.html"},
          {label:"FAQ", href:"faq.html"}
        ]
      },
      {
        title: "Encyclopédique (en cours de création)",
        items: [
          {label:"Page encyclopédique", href:"Wikipedia.html"},
          {label:"Fiche utilisateur (projet)", href:"Utilisateur_Wikipedia.html"}
        ]
      }
    ];

    // ===== util: retour page précédente =====
    function goBack(){
      try{
        if (history.length > 1) history.back();
        else location.href = "index.html";
      }catch(e){
        location.href = "index.html";
      }
    }

    // ===== fond: charger la page précédente derrière =====
    (function setBehind(){
      const f = document.getElementById("behindFrame");
      const ref = document.referrer || "";
      // même domaine uniquement (évite blocages)
      if(ref.includes(location.origin)){
        f.src = ref;
      }else{
        f.src = "index.html";
      }
    })();

    // ===== rendre le menu =====
    const root = document.getElementById("menuRoot");

    function lockSVG(){
      return `
        <span class="lock" aria-hidden="true" title="Accès réservé">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M7 10V8a5 5 0 0 1 10 0v2" stroke="#3a2417" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 10h12v10H6V10Z" stroke="#3a2417" stroke-width="2" />
            <path d="M12 14v3" stroke="#3a2417" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
      `;
    }

    function stylizeFirstLetter(text){
      if(!text || !text.length) return "";
      const first = text[0];
      const rest = text.slice(1);
      // IMPORTANT: pas d'espace ajouté
      return `<span class="dropcap">${first}</span>${rest}`;
    }

    function makeChevron(){
      return `
        <span class="chev" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="#2b1a0f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
      `;
    }

    function render(){
      root.innerHTML = "";
      MENU_DATA.forEach((sec, i) => {
        const details = document.createElement("details");
        details.className = "section";
        details.dataset.autoclose = "1";

        const summary = document.createElement("summary");
        summary.innerHTML = `
          <div class="sumText" data-write="${sec.title}"></div>
          ${makeChevron()}
        `;

        const items = document.createElement("div");
        items.className = "items";

        sec.items.forEach((it, idx) => {
          const a = document.createElement("a");
          a.className = "item" + (idx>0 ? " itemIndent" : "");
          a.href = it.href;

          const labelHTML = `<span class="itemText" data-write="${it.label}"></span>`;
          a.innerHTML = (it.locked ? lockSVG() : "") + labelHTML;

          a.addEventListener("click", () => {
            // son petit "épee" au clic
            safePlay("sndSword", 0.55);
          });

          items.appendChild(a);
        });

        details.appendChild(summary);
        details.appendChild(items);
        root.appendChild(details);
      });
    }
    render();

    // ===== Sons: lecture safe =====
    function safePlay(id, vol=0.9){
      const a = document.getElementById(id);
      if(!a) return;
      a.volume = vol;
      a.currentTime = 0;
      a.play().catch(()=>{});
    }

    // ===== écrire comme une plume =====
    function writeEl(el, text, speed=18){
      return new Promise(resolve => {
        el.innerHTML = "";
        let i = 0;
        const tick = () => {
          if(i === 0) safePlay("sndWrite", 0.35);
          const ch = text[i++];
          if(ch === undefined){ resolve(); return; }
          // première lettre rouge
          if(i === 1){
            el.innerHTML = `<span class="dropcap">${text[0]}</span>`;
          }else{
            el.innerHTML += ch;
          }
          if(i <= text.length){
            setTimeout(tick, speed);
          }else{
            resolve();
          }
        };
        tick();
      });
    }

    async function writeAll(){
      // titre
      const title = document.getElementById("title");
      await writeEl(title, title.dataset.write || "Menu de navigation", 18);

      // sections + items
      const all = document.querySelectorAll("[data-write]");
      for(const node of all){
        // évite de réécrire le titre (déjà fait)
        if(node === title) continue;
        const txt = node.dataset.write || "";
        // on écrit le texte (sans ajouter d'espaces)
        await writeEl(node, txt, 10);
      }

      // fin: signature + sons
      safePlay("sndSword", 0.55);
      setTimeout(()=> safePlay("sndSeal", 0.9), 350);
    }

    // ===== hover open/close (desktop) + autoclose =====
    let closeTimers = new WeakMap();

    function scheduleClose(details){
      clearTimeout(closeTimers.get(details));
      const t = setTimeout(() => { details.open = false; }, 2600);
      closeTimers.set(details, t);
    }

    document.querySelectorAll("details").forEach(d => {
      d.addEventListener("pointerenter", (e) => {
        // desktop hover only
        if(e.pointerType === "mouse"){
          d.open = true;
          scheduleClose(d);
        }
      });
      d.addEventListener("pointerleave", (e) => {
        if(e.pointerType === "mouse"){
          scheduleClose(d);
        }
      });
      d.addEventListener("toggle", () => {
        if(d.open) scheduleClose(d);
      });
    });

    // ===== boutons retour/fermer + clic fond =====
    document.getElementById("btnBack").addEventListener("click", goBack);
    document.getElementById("btnBackBig").addEventListener("click", goBack);
    document.getElementById("btnClose").addEventListener("click", goBack);
    document.getElementById("clickback").addEventListener("click", goBack);

    // ESC
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") goBack(); });

    // ===== lancement: son parchemin + écriture =====
    // (sur mobile, le son peut nécessiter un premier tap — normal)
    safePlay("sndOpen", 0.75);
    writeAll();
  </script>
</body>
</html>
